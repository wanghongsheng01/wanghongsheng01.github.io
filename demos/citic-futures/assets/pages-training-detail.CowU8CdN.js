var e=(e,t,a)=>new Promise((l,s)=>{var n=e=>{try{c(a.next(e))}catch(t){s(t)}},o=e=>{try{c(a.throw(e))}catch(t){s(t)}},c=e=>e.done?l(e.value):Promise.resolve(e.value).then(n,o);c((a=a.apply(e,t)).next())});import{d as t,r as a,o as l,Q as s,R as n,T as o,e as c,f as i,i as r,w as d,x as u,J as f,P as h,g,K as v,U as p,F as m,y as _,t as y,k as b,j as x,V as k,q as C,s as w,n as F,W as S,C as T,D as M,H as D,X as N}from"./index-BWcxsYn8.js";import{_ as L}from"./_plugin-vue_export-helper.BCo6x5W8.js";import{N as P}from"./NavigationBar.BembfXLU.js";const $=L(t({__name:"KLineChart",props:{data:{},width:{default:350},height:{default:240},period:{default:"day"},indicators:{default:()=>["MA"]},enableScroll:{type:Boolean,default:!1}},setup(e){const t=e,k=a(t.width),C=a(t.height),w=a(null),F=a(null);let S=null;function T(){if(!t.enableScroll||!t.data.length)return k.value;return 60+12*t.data.length+20}const M={top:30,right:20,bottom:60,left:60},D=8,N=3,L=.6,P=.2,$=.2,A={up:"#FF4444",down:"#00C851",grid:"#E5E5E5",text:"#666666",volume:"#CCCCCC"};function W(e,t){const a=[];for(let l=0;l<e.length;l++){if(l<t-1){a.push(NaN);continue}let s=0;for(let a=l-t+1;a<=l;a++)s+=e[a].close;a.push(s/t)}return a}function E(e,t){const a=[],l=2/(t+1);for(let s=0;s<e.length;s++)0===s?a.push(e[s]):a.push(e[s]*l+a[s-1]*(1-l));return a}function K(){if(console.log("drawChart called with:",{hasContext:!!S,dataLength:t.data.length,enableScroll:t.enableScroll}),!S||!t.data.length)return void console.log("Exiting drawChart: no context or no data");const e=S,a=t.enableScroll?T():k.value,l=t.enableScroll?C.value+50:C.value,s=M;console.log("Drawing with dimensions:",{width:a,height:l}),e.clearRect(0,0,a,l);const n=a-s.left-s.right,o=l-s.top-s.bottom,c=t.indicators.includes("MACD"),i=o*L,r=o*P,d=c?o*$:0,u=s.top,f=u+i+5,h=f+r+5,g=t.data.flatMap(e=>[e.high,e.low,e.open,e.close]),v=t.data.map(e=>e.volume),p=Math.max(...g),m=Math.min(...g),_=Math.max(...v),y=i/(p-m||1),b=r/(_||1);e.setFillStyle("#FFFFFF"),e.fillRect(0,0,a,l),function(e,t,a,l){e.setStrokeStyle(A.grid),e.setLineWidth(.5);for(let n=0;n<=4;n++){const s=t.top+l/4*n;e.beginPath(),e.moveTo(t.left,s),e.lineTo(t.left+a,s),e.stroke()}const s=6;for(let n=0;n<=s;n++){const o=t.left+a/s*n;e.beginPath(),e.moveTo(o,t.top),e.lineTo(o,t.top+l),e.stroke()}}(e,s,n,i),function(e,t,a,l,s){e.setStrokeStyle(A.grid),e.setLineWidth(.5),e.beginPath(),e.moveTo(t.left,s),e.lineTo(t.left+a,s),e.stroke(),e.beginPath(),e.moveTo(t.left,s+l),e.lineTo(t.left+a,s+l),e.stroke();const n=6;for(let o=0;o<=n;o++){const c=t.left+a/n*o;e.beginPath(),e.moveTo(c,s),e.lineTo(c,s+l),e.stroke()}}(e,s,n,r,f),c&&function(e,t,a,l,s){e.setStrokeStyle(A.grid),e.setLineWidth(.5),e.beginPath(),e.moveTo(t.left,s),e.lineTo(t.left+a,s),e.stroke(),e.beginPath(),e.moveTo(t.left,s+l),e.lineTo(t.left+a,s+l),e.stroke();const n=6;for(let o=0;o<=n;o++){const c=t.left+a/n*o;e.beginPath(),e.moveTo(c,s),e.lineTo(c,s+l),e.stroke()}}(e,s,n,d,h);let x,w,F,K=t.data;if(t.enableScroll)x=10,w=2,K=t.data,F=s.left;else{if(0===t.data.length)x=D,w=N;else{const e=3,a=1,l=12,s=4,o=Math.floor(n/(e+a));if(t.data.length<=o){K=t.data;const o=n,c=K.length;if(1===c)x=Math.min(l,o),w=0;else{const t=.7*o,n=.3*o;x=Math.max(e,Math.min(l,t/c)),w=Math.max(a,Math.min(s,n/(c-1)));const i=x*c+w*(c-1);if(i>o){const e=o/i;x*=e,w*=e}}}else{K=t.data.slice(-o);const l=n,s=K.length,c=.8*l,i=.2*l;x=Math.max(e,c/s),w=Math.max(a,i/(s-1))}}F=s.left}const B=x+w,X=F+(K.length-1)*B+x,H=X<=a;console.log("K-line drawing parameters:",{displayDataLength:K.length,candleWidth:x,spacing:w,totalCandleWidth:B,startX:F,canvasWidth:a,chartWidth:n,lastCandleX:X,isLastCandleVisible:H}),console.log(`📊 绘制K线: 数据${K.length}条，起始X=${F}，最后K线X=${X}，Canvas宽=${a}，${H?"✅全部可见":"⚠️需要滚动"}`),K.forEach((t,a)=>{const l=F+a*B;!function(e,t,a,l,s,n,o,c){const{open:i,high:r,low:d,close:u}=t,f=u>=i,h=f?A.up:A.down,g=l+c-(r-s)*n,v=l+c-(d-s)*n,p=l+c-(i-s)*n,m=l+c-(u-s)*n;e.setStrokeStyle(h),e.setLineWidth(1),e.beginPath(),e.moveTo(a+o/2,g),e.lineTo(a+o/2,v),e.stroke();const _=Math.min(p,m),y=Math.abs(m-p)||1;e.setStrokeStyle(h),e.setLineWidth(1),f?(e.setFillStyle("#FFFFFF"),e.fillRect(a,_,o,y),e.strokeRect(a,_,o,y)):(e.setFillStyle(h),e.fillRect(a,_,o,y))}(e,t,l,u,m,y,x,i),function(e,t,a,l,s,n,o){const c=Math.min(t*s,o);e.setFillStyle(A.volume),e.fillRect(a,l+o-c,n,c)}(e,t.volume,l,f,b,x,r)}),function(e,a,l,s,n,o,c,i,r,d,u){if(!t.indicators||0===t.indicators.length)return;t.indicators.forEach(t=>{switch(t){case"MA":!function(e,t,a,l,s,n,o,c){const i=W(t,5),r=W(t,10),d=W(t,20);O(e,i,t,a,l,s,n,o,c,"#FFA500",1),O(e,r,t,a,l,s,n,o,c,"#9932CC",1),O(e,d,t,a,l,s,n,o,c,"#1E90FF",1)}(e,a,l,s,n,o,c,i);break;case"BOLL":!function(e,t,a,l,s,n,o,c){const i=function(e,t=20,a=2){const l=W(e,t),s=[],n=[];for(let o=0;o<e.length;o++){if(o<t-1){s.push(NaN),n.push(NaN);continue}let c=0;for(let a=o-t+1;a<=o;a++)c+=Math.pow(e[a].close-l[o],2);const i=Math.sqrt(c/t);s.push(l[o]+a*i),n.push(l[o]-a*i)}return{middle:l,upper:s,lower:n}}(t,20,2);O(e,i.middle,t,a,l,s,n,o,c,"#FFFFFF",1),O(e,i.upper,t,a,l,s,n,o,c,"#FF4444",1),O(e,i.lower,t,a,l,s,n,o,c,"#00C851",1)}(e,a,l,s,n,o,c,i);break;case"MACD":u>0&&function(e,t,a,l,s,n){const o=function(e,t=12,a=26,l=9){const s=e.map(e=>e.close),n=E(s,t),o=E(s,a),c=[];for(let d=0;d<e.length;d++)isNaN(n[d])||isNaN(o[d])?c.push(NaN):c.push(n[d]-o[d]);const i=E(c,l),r=[];for(let d=0;d<c.length;d++)isNaN(c[d])||isNaN(i[d])?r.push(NaN):r.push(c[d]-i[d]);return{macd:c,signal:i,histogram:r}}(t),c=[...o.macd,...o.signal,...o.histogram].filter(e=>!isNaN(e));if(0===c.length)return;const i=Math.max(...c),r=Math.min(...c),d=n/(i-r||1);e.setStrokeStyle("#666666"),e.setLineWidth(.5),e.beginPath();const u=l+n- -r*d;e.moveTo(a,u),e.lineTo(a+t.length*s,u),e.stroke(),t.forEach((t,l)=>{if(isNaN(o.histogram[l]))return;const n=a+l*s,c=o.histogram[l],i=Math.abs(c*d),r=c>0?u-i:u;e.setFillStyle(c>0?"#FF4444":"#00C851"),e.fillRect(n,r,s-1,i)}),R(e,o.macd,t,a,l,s,r,d,n,"#FFFFFF",1),R(e,o.signal,t,a,l,s,r,d,n,"#FFA500",1)}(e,a,l,d,n,u)}})}(e,K,F,u,B,m,y,i,0,h,d),function(e,t,a,l,s,n,o,c,i,r,d,u,f){e.setFillStyle(A.text),e.setFontSize(10),e.setTextAlign("right");for(let h=0;h<=4;h++){const t=c+(i-c)*(4-h)/4,l=d+s/4*h+3;e.fillText(t.toFixed(2),a.left-5,l)}e.setTextAlign("left"),e.fillText(`成交量:${(r/1e4).toFixed(1)}万`,a.left,u+15),o>0&&e.fillText("MACD",a.left,f+15)}(e,0,s,0,i,0,d,m,p,_,u,f,h),console.log("Drawing time axis with data:",{dataLength:K.length,startX:F,totalCandleWidth:B,width:a,height:l}),function(e,a,l,s,n,o,c){if(console.log("drawTimeAxis called with:",{dataLength:a.length,startX:l,candleWidth:s,chartWidth:o}),0===a.length)return void console.log("No data for time axis");if(t.enableScroll)return void console.log("Scroll mode: skipping Canvas time axis, using HTML overlay");e.setFillStyle("#666666"),e.setFontSize(12),e.setTextAlign("center");const i=Math.max(1,Math.floor(a.length/10)),r=c-20;for(let t=0;t<a.length;t+=i){const n=l+t*s+s/2,o=a[t].date;let c=o;if(o.includes("/")){const e=o.split("/");e.length>=3&&(c=`${e[0]}-${e[1]}`)}else if(o.includes("-")){const e=o.split("-");e.length>=3&&(c=`${e[1]}-${e[2]}`)}e.fillText(c,n,r)}}(e,K,F,B,0,a,l),t.enableScroll&&(console.log("Updating HTML time labels for scroll mode"),I()),e.draw()}l(()=>{console.log("KLineChart mounted with props:",{enableScroll:t.enableScroll,dataLength:t.data.length,width:t.width,height:t.height}),s(()=>{setTimeout(()=>{if(console.log("Starting canvas initialization..."),function(){t.enableScroll?(S=o("klineCanvasScroll"),console.log("Using uni-app canvas for scroll mode:",S)):(S=o("klineCanvas"),console.log("Using uni-app canvas for normal mode:",S));S?setTimeout(()=>{K()},100):console.error("Failed to initialize canvas context")}(),t.data.length>0?(console.log("Calling drawChart with data length:",t.data.length),K(),t.enableScroll&&setTimeout(()=>{I()},300)):console.log("No data available for drawing"),t.enableScroll&&F.value){console.log("Scroll container setup:",{scrollContainer:F.value,scrollWidth:F.value.scrollWidth,clientWidth:F.value.clientWidth,canScrollHorizontally:F.value.scrollWidth>F.value.clientWidth});const e=F.value;e.style.overflowX="auto",e.style.overflowY="hidden"}},200)})}),n(()=>t.data,()=>{S&&t.data.length>0&&K()},{deep:!0}),n(()=>t.indicators,()=>{S&&t.data.length>0&&K()},{deep:!0});const B=a([]);function I(){var e,a;if(!t.data||0===t.data.length)return console.log("No data for time labels"),[];const l=M,s=l.left,n=Math.max(1,Math.floor(t.data.length/10)),o=[],c=C.value-l.top-l.bottom,i=l.top+c-5;for(let d=0;d<t.data.length;d+=n){const e=s+12*d+5,a=t.data[d].date;let l=a;if(a.includes("/")){const e=a.split("/");if(3===e.length){const t=e[0].padStart(2,"0"),a=e[1].padStart(2,"0");e[2],l=`${a}/${t}`}}else if(a.includes("-")){const e=a.split("-");if(e.length>=3){l=`${e[1].padStart(2,"0")}/${e[2].padStart(2,"0")}`}}try{let e=a;if(a.includes("/")){const t=a.split("/");3===t.length&&(e=`${t[1]}/${t[0]}/${t[2]}`)}const t=new Date(e);if(!isNaN(t.getTime())){const e=(t.getMonth()+1).toString().padStart(2,"0");l=`${e}/${t.getDate().toString().padStart(2,"0")}`}}catch(r){console.log("Date parsing error for:",a,r)}o.push({x:e,y:i,text:l})}return B.value=[...o],console.log("Generated time labels:",{totalLabels:o.length,sampleLabels:o.slice(0,3).map(e=>({text:e.text,x:e.x,y:e.y})),dataRange:`${null==(e=t.data[0])?void 0:e.date} to ${null==(a=t.data[t.data.length-1])?void 0:a.date}`,totalDataPoints:t.data.length,positioning:{canvasHeight:C.value,paddingTop:l.top,paddingBottom:l.bottom,chartHeight:c,calculatedTimeAxisY:i,explanation:`顶部padding${l.top} + 图表高度${c} - 5 = ${i}`}}),o}function O(e,t,a,l,s,n,o,c,i,r,d){e.setStrokeStyle(r),e.setLineWidth(d),e.beginPath();let u=!1;t.forEach((t,a)=>{if(isNaN(t))return;const r=l+a*n+n/2,d=s+i-(t-o)*c;u?e.lineTo(r,d):(e.moveTo(r,d),u=!0)}),e.stroke()}function R(e,t,a,l,s,n,o,c,i,r,d){e.setStrokeStyle(r),e.setLineWidth(d),e.beginPath();let u=!1;t.forEach((t,a)=>{if(isNaN(t))return;const r=l+a*n+n/2,d=s+i-(t-o)*c;u?e.lineTo(r,d):(e.moveTo(r,d),u=!0)}),e.stroke()}function X(e){U(e)}function H(e){U(e)}function z(){w.value=null}function U(e){if(!t.data.length)return;e.touches[0]||e.changedTouches[0];const a=Math.floor(Math.random()*t.data.length);a>=0&&a<t.data.length&&(w.value=t.data[a])}return(e,a)=>{const l=p,s=x,n=r;return i(),c(n,{class:"kline-chart"},{default:d(()=>[e.enableScroll?(i(),u("div",{key:0,class:"kline-scroll-container",ref_key:"scrollContainer",ref:F},[h("div",{style:v([{position:"relative"},`width: ${T()}px; min-width: ${T()}px;`])},[g(l,{"canvas-id":"klineCanvasScroll",width:T(),height:C.value+50,style:v(`width: ${T()}px; height: ${C.value+50}px; display: block; min-width: ${T()}px;`),class:"kline-canvas-scrollable"},null,8,["width","height","style"]),t.data.length>0?(i(),u("div",{key:0,class:"time-labels-overlay",style:v(`width: ${T()}px; height: ${C.value+50}px;`)},[(i(!0),u(m,null,_(B.value,(e,t)=>(i(),u("div",{key:`time-${t}-${e.text}`,class:"time-label",style:v(`left: ${e.x}px; top: ${e.y}px;`)},y(e.text),5))),128))],4)):f("",!0)],4)],512)):(i(),c(l,{key:1,"canvas-id":"klineCanvas",style:v(`width: ${k.value}px; height: ${C.value}px;`),onTouchstart:X,onTouchmove:H,onTouchend:z},null,8,["style"])),w.value?(i(),c(n,{key:2,class:"tooltip"},{default:d(()=>[g(s,{class:"tooltip-text"},{default:d(()=>[b("日期: "+y(w.value.date),1)]),_:1}),g(s,{class:"tooltip-text"},{default:d(()=>[b("开盘: "+y(w.value.open),1)]),_:1}),g(s,{class:"tooltip-text"},{default:d(()=>[b("最高: "+y(w.value.high),1)]),_:1}),g(s,{class:"tooltip-text"},{default:d(()=>[b("最低: "+y(w.value.low),1)]),_:1}),g(s,{class:"tooltip-text"},{default:d(()=>[b("收盘: "+y(w.value.close),1)]),_:1}),g(s,{class:"tooltip-text"},{default:d(()=>[b("成交量: "+y(w.value.volume),1)]),_:1})]),_:1})):f("",!0),e.indicators&&e.indicators.length>0?(i(),c(n,{key:3,class:"indicator-legend"},{default:d(()=>[e.indicators.includes("MA")?(i(),c(n,{key:0,class:"legend-group"},{default:d(()=>[g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#FFA500"}}),g(s,{class:"legend-text"},{default:d(()=>[b("MA5")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#9932CC"}}),g(s,{class:"legend-text"},{default:d(()=>[b("MA10")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#1E90FF"}}),g(s,{class:"legend-text"},{default:d(()=>[b("MA20")]),_:1})]),_:1})]),_:1})):f("",!0),e.indicators.includes("BOLL")?(i(),c(n,{key:1,class:"legend-group"},{default:d(()=>[g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#FFFFFF",border:"1px solid #ccc"}}),g(s,{class:"legend-text"},{default:d(()=>[b("BOLL中轨")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#FF4444"}}),g(s,{class:"legend-text"},{default:d(()=>[b("BOLL上轨")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#00C851"}}),g(s,{class:"legend-text"},{default:d(()=>[b("BOLL下轨")]),_:1})]),_:1})]),_:1})):f("",!0),e.indicators.includes("MACD")?(i(),c(n,{key:2,class:"legend-group"},{default:d(()=>[g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#FFFFFF",border:"1px solid #ccc"}}),g(s,{class:"legend-text"},{default:d(()=>[b("DIF")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(n,{class:"legend-color",style:{"background-color":"#FFA500"}}),g(s,{class:"legend-text"},{default:d(()=>[b("DEA")]),_:1})]),_:1}),g(n,{class:"legend-item"},{default:d(()=>[g(s,{class:"legend-text"},{default:d(()=>[b("柱状图")]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})):f("",!0)]),_:1})}}}),[["__scopeId","data-v-dd9fbdf7"]]),A=L(t({__name:"detail",setup(t){const s=a({symbol:"",name:"",type:"trend",duration:0,startDate:"",trainStartDate:"",currentPrice:0,volatility:0,changePercent:0}),n=a({sessionId:"",currentDay:0,totalDays:20,predictions:0,correctPredictions:0,accuracy:0,stage:""}),o=a([]),h=a([]),v=a("news"),p=a([]),L=a("day"),A=a(!1),W=a(["MA"]),E=a(!1),K=a(null),B=a(!1),I=a(!1),O=a(""),R=a(""),X=a(!1);function H(e){n.value={sessionId:String(e),currentDay:0,totalDays:s.value.duration||20,predictions:0,correctPredictions:0,accuracy:0,stage:"trend"===s.value.type?"趋势训练":"震荡训练"},I.value=!1}function z(e){const t=W.value.indexOf(e);t>-1?W.value.length>1&&W.value.splice(t,1):W.value.push(e)}function U(e){v.value=e}function j(t){return e(this,null,function*(){try{T({title:"提交预测中..."});const a=yield C.submitTrainingPrediction({id:Number(O.value),operation:"bull"===t?1:0});if(console.log("预测提交响应:",a),0===a.code&&a.data){const l=a.data;if(K.value={predictionDate:l.operationTime||l.date||(new Date).toLocaleDateString(),prediction:t,actualChange:Number(l.profitLoss||l.actualChange||0),isCorrect:1===l.result||1===l.isCorrect,explanation:l.explanation||l.remark||"已提交预测",newStats:{predictions:n.value.predictions+1,correctPredictions:n.value.correctPredictions+(1===l.result?1:0),accuracy:0},isCompleted:!1},K.value.newStats.accuracy=Math.round(K.value.newStats.correctPredictions/K.value.newStats.predictions*100),n.value.predictions=K.value.newStats.predictions,n.value.correctPredictions=K.value.newStats.correctPredictions,n.value.accuracy=K.value.newStats.accuracy,n.value.currentDay++,h.value.unshift({date:K.value.predictionDate,prediction:t,actualChange:K.value.actualChange,isCorrect:K.value.isCorrect}),E.value=!0,n.value.currentDay>=n.value.totalDays){K.value.isCompleted=!0,I.value=!0,B.value=!0;try{yield C.reportUserEvent({eventType:"training_completed",eventData:{trainingId:O.value,accuracy:n.value.accuracy},timestamp:(new Date).toISOString()})}catch(e){console.error("上报训练事件失败:",e)}}}else w({title:a.msg||"提交失败",icon:"none"})}catch(e){console.error("提交预测失败:",e),w({title:"提交失败",icon:"error"})}finally{M()}})}function q(){E.value=!1,K.value=null}function V(){B.value=!1,D()}function Y(){B.value=!1,w({title:"功能开发中",icon:"none"})}function G(){const e=(N().screenWidth||375)-32-48;return Math.max(320,Math.min(e,750))}function J(){const e=N().screenHeight||667;let t;return t=e<=667?280:e<=812?320:e<=896?360:400,t}return k(e=>{e.marketId&&(O.value=e.marketId),e.mode&&(R.value=e.mode)}),l(()=>{v.value="news",function(){e(this,null,function*(){if(O.value){X.value=!0;try{const t=Number(O.value),a=yield C.getTrainingDetail(t);if(0===a.code&&a.data){const l=a.data;s.value={symbol:l.tradeCode||"",name:l.tradeCodeCn||l.tradeCode||"",type:0===l.tradeType?"trend":"swing",duration:l.dateLength||0,startDate:l.beginDate||"",trainStartDate:l.trainStartDate||"",currentPrice:0,volatility:l.volatility?100*l.volatility:0,changePercent:l.chg||0},yield function(t){return e(this,null,function*(){if(t){A.value=!0;try{const e=yield C.getKLineData(t);if(console.log("K线数据响应:",e),0===e.code&&e.data)if(Array.isArray(e.data)){if(p.value=e.data.map(e=>({date:e.date||e.time||e.timestamp||"",open:Number(e.open||e.openPrice||0),high:Number(e.high||e.highPrice||0),low:Number(e.low||e.lowPrice||0),close:Number(e.close||e.closePrice||0),volume:Number(e.volume||e.vol||0)})),console.log("格式化后的K线数据:",p.value.slice(0,3)),p.value.length>0){const e=p.value[p.value.length-1];if(s.value.currentPrice=e.close,p.value.length>1){const t=p.value[p.value.length-2].close;t>0&&(s.value.changePercent=Number(((e.close-t)/t*100).toFixed(2)))}}}else console.warn("K线数据格式不正确，不是数组"),p.value=[]}catch(e){console.error("加载K线数据失败:",e)}finally{A.value=!1}}})}(t),yield function(t){return e(this,null,function*(){try{const e=yield C.getTrainingNews(t);console.log("参考资讯响应:",e),0===e.code&&e.data&&(Array.isArray(e.data)?o.value=e.data.map(e=>({date:e.createTime||e.date||e.time||"",title:e.title||"无标题",content:e.content||e.newsContent||"",isExpanded:!1})):o.value=[])}catch(e){console.error("加载参考资讯失败:",e),o.value=[]}})}(t),yield function(t){return e(this,null,function*(){try{const e=yield C.getTrainingRecords(t);if(console.log("训练记录响应:",e),0===e.code&&e.data)if(Array.isArray(e.data)){const a=e.data;h.value=a.map(e=>({date:e.operationTime||e.date||"",prediction:1===e.operation?"bull":"bear",actualChange:Number(e.actualChange||e.profitLoss||0),isCorrect:1===e.isCorrect||1===e.result}));const l=a.length,o=a.filter(e=>1===e.isCorrect||1===e.result).length,c=l>0?Math.round(o/l*100):0;n.value={sessionId:String(t),currentDay:l,totalDays:s.value.duration||20,predictions:l,correctPredictions:o,accuracy:c,stage:"trend"===s.value.type?"趋势训练":"震荡训练"},I.value=l>=(s.value.duration||20)}else h.value=[],H(t);else h.value=[],H(t)}catch(e){console.error("加载训练记录失败:",e),h.value=[],H(t)}})}(t)}}catch(t){console.error("加载训练详情失败:",t),w({title:"加载失败",icon:"error"})}finally{X.value=!1}}})}()}),(e,t)=>{const a=x,l=r;return i(),c(l,{class:"training-detail-page"},{default:d(()=>[g(P,{title:"训练详情"}),g(l,{class:"page-content"},{default:d(()=>[g(l,{class:"market-info-section"},{default:d(()=>[g(l,{class:"market-header"},{default:d(()=>[g(l,{class:"market-basic"},{default:d(()=>[g(a,{class:"market-symbol"},{default:d(()=>[b(y(s.value.symbol),1)]),_:1}),g(a,{class:"market-name"},{default:d(()=>[b(y(s.value.name),1)]),_:1})]),_:1}),g(l,{class:"market-tags"},{default:d(()=>[g(a,{class:F(["tag type",`tag-${s.value.type}`])},{default:d(()=>[b(y("trend"===s.value.type?"趋势":"震荡"),1)]),_:1},8,["class"]),g(a,{class:"tag duration"},{default:d(()=>[b(y(s.value.duration)+"天",1)]),_:1})]),_:1})]),_:1}),g(l,{class:"market-stats"},{default:d(()=>[g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-label"},{default:d(()=>[b("最新价")]),_:1}),g(a,{class:"stat-value"},{default:d(()=>[b("¥ "+y(s.value.currentPrice),1)]),_:1})]),_:1}),g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-label"},{default:d(()=>[b("波动率")]),_:1}),g(a,{class:"stat-value"},{default:d(()=>[b(y(s.value.volatility)+"%",1)]),_:1})]),_:1}),g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-label"},{default:d(()=>[b("涨跌幅")]),_:1}),g(a,{class:F(["stat-value",{positive:s.value.changePercent>0,negative:s.value.changePercent<0}])},{default:d(()=>[b(y(s.value.changePercent>0?"+":"")+y(s.value.changePercent)+"% ",1)]),_:1},8,["class"])]),_:1})]),_:1}),g(l,{class:"market-dates"},{default:d(()=>[g(l,{class:"date-item"},{default:d(()=>[g(a,{class:"date-label"},{default:d(()=>[b("开始日期")]),_:1}),g(a,{class:"date-value"},{default:d(()=>[b(y(s.value.startDate),1)]),_:1})]),_:1}),g(l,{class:"date-item"},{default:d(()=>[g(a,{class:"date-label"},{default:d(()=>[b("训练起始")]),_:1}),g(a,{class:"date-value"},{default:d(()=>[b(y(s.value.trainStartDate),1)]),_:1})]),_:1})]),_:1})]),_:1}),g(l,{class:"training-stats-section"},{default:d(()=>[g(l,{class:"stats-header"},{default:d(()=>[g(a,{class:"stats-title"},{default:d(()=>[b("训练统计")]),_:1}),g(a,{class:"stats-stage"},{default:d(()=>[b(y(n.value.stage),1)]),_:1})]),_:1}),g(l,{class:"stats-grid"},{default:d(()=>[g(l,{class:"stats-item"},{default:d(()=>[g(a,{class:"stats-label"},{default:d(()=>[b("训练进度")]),_:1}),g(a,{class:"stats-value"},{default:d(()=>[b(y(n.value.currentDay)+"/"+y(n.value.totalDays),1)]),_:1})]),_:1}),g(l,{class:"stats-item"},{default:d(()=>[g(a,{class:"stats-label"},{default:d(()=>[b("训练次数")]),_:1}),g(a,{class:"stats-value"},{default:d(()=>[b(y(n.value.predictions),1)]),_:1})]),_:1}),g(l,{class:"stats-item"},{default:d(()=>[g(a,{class:"stats-label"},{default:d(()=>[b("胜率")]),_:1}),g(a,{class:"stats-value accent"},{default:d(()=>[b(y(n.value.accuracy||0)+"%",1)]),_:1})]),_:1})]),_:1})]),_:1}),g(l,{class:"kline-section"},{default:d(()=>[g(l,{class:"kline-header"},{default:d(()=>[g(a,{class:"kline-title"},{default:d(()=>[b("K线图")]),_:1}),g(l,{class:"kline-period"},{default:d(()=>[g(a,{class:"period-text"},{default:d(()=>[b("日K线")]),_:1})]),_:1})]),_:1}),g(l,{class:"kline-chart-container"},{default:d(()=>[A.value?(i(),c(l,{key:0,class:"loading-placeholder"},{default:d(()=>[g(a,{class:"loading-text"},{default:d(()=>[b("加载中...")]),_:1})]),_:1})):p.value.length>0?(i(),c($,{key:1,data:p.value,width:G(),height:J(),period:L.value,indicators:W.value,enableScroll:!0},null,8,["data","width","height","period","indicators"])):(i(),c(l,{key:2,class:"chart-placeholder"},{default:d(()=>[g(a,{class:"chart-icon"},{default:d(()=>[b("📈")]),_:1}),g(a,{class:"chart-text"},{default:d(()=>[b("暂无K线数据")]),_:1}),g(a,{class:"chart-hint"},{default:d(()=>[b("请稍后重试")]),_:1})]),_:1}))]),_:1}),g(l,{class:"indicators"},{default:d(()=>[g(l,{class:F(["indicator-btn",{active:W.value.includes("MA")}]),onClick:t[0]||(t[0]=e=>z("MA"))},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("MA")]),_:1})]),_:1},8,["class"]),g(l,{class:F(["indicator-btn",{active:W.value.includes("BOLL")}]),onClick:t[1]||(t[1]=e=>z("BOLL"))},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("BOLL")]),_:1})]),_:1},8,["class"]),g(l,{class:F(["indicator-btn",{active:W.value.includes("MACD")}]),onClick:t[2]||(t[2]=e=>z("MACD"))},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("MACD")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),g(l,{class:"tab-section"},{default:d(()=>[g(l,{class:"tab-header"},{default:d(()=>[g(l,{class:F(["tab-item",{active:"news"===v.value}]),onClick:t[3]||(t[3]=e=>U("news"))},{default:d(()=>[g(a,{class:"tab-text"},{default:d(()=>[b("参考资讯")]),_:1})]),_:1},8,["class"]),g(l,{class:F(["tab-item",{active:"records"===v.value}]),onClick:t[4]||(t[4]=e=>U("records"))},{default:d(()=>[g(a,{class:"tab-text"},{default:d(()=>[b("训练记录")]),_:1})]),_:1},8,["class"])]),_:1}),g(l,{class:"tab-content"},{default:d(()=>["news"===v.value?(i(),c(l,{key:0,class:"news-content"},{default:d(()=>[(i(!0),u(m,null,_(o.value,(e,t)=>(i(),c(l,{key:t,class:"news-item"},{default:d(()=>[g(l,{class:"news-header"},{default:d(()=>[g(a,{class:"news-title"},{default:d(()=>[b(y(e.title),1)]),_:2},1024),g(a,{class:"news-date"},{default:d(()=>[b(y(e.date),1)]),_:2},1024)]),_:2},1024),g(l,{class:"news-body"},{default:d(()=>[g(a,{class:F(["news-text",{expanded:e.isExpanded}])},{default:d(()=>[b(y(e.content),1)]),_:2},1032,["class"]),g(a,{class:"news-toggle",onClick:e=>function(e){o.value[e].isExpanded=!o.value[e].isExpanded}(t)},{default:d(()=>[b(y(e.isExpanded?"收起":"展开"),1)]),_:2},1032,["onClick"])]),_:2},1024)]),_:2},1024))),128))]),_:1})):f("",!0),"records"===v.value?(i(),c(l,{key:1,class:"records-content"},{default:d(()=>[(i(!0),u(m,null,_(h.value,e=>(i(),c(l,{key:e.date,class:F(["record-item",{correct:e.isCorrect,wrong:!e.isCorrect}])},{default:d(()=>[g(l,{class:"record-info"},{default:d(()=>[g(a,{class:"record-date"},{default:d(()=>[b(y(e.date),1)]),_:2},1024),g(a,{class:"record-prediction"},{default:d(()=>[b(y("bull"===e.prediction?"看多":"看空"),1)]),_:2},1024)]),_:2},1024),g(l,{class:"record-result"},{default:d(()=>[g(a,{class:F(["result-change",{positive:e.actualChange>0,negative:e.actualChange<0}])},{default:d(()=>[b(y(e.actualChange>0?"+":"")+y(e.actualChange)+"% ",1)]),_:2},1032,["class"]),g(a,{class:F(["result-status",{correct:e.isCorrect,wrong:!e.isCorrect}])},{default:d(()=>[b(y(e.isCorrect?"正确":"错误"),1)]),_:2},1032,["class"])]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})):f("",!0)]),_:1})]),_:1}),I.value?f("",!0):(i(),c(l,{key:0,class:"action-buttons"},{default:d(()=>[g(l,{class:"action-btn bull",onClick:t[5]||(t[5]=e=>j("bull"))},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("看多")]),_:1})]),_:1}),g(l,{class:"action-btn bear",onClick:t[6]||(t[6]=e=>j("bear"))},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("看空")]),_:1})]),_:1})]),_:1})),E.value&&K.value?(i(),c(l,{key:1,class:"modal-overlay",onClick:q},{default:d(()=>[g(l,{class:"prediction-modal",onClick:t[7]||(t[7]=S(()=>{},["stop"]))},{default:d(()=>[g(l,{class:"modal-header"},{default:d(()=>[g(a,{class:"modal-title"},{default:d(()=>[b("预测结果")]),_:1})]),_:1}),g(l,{class:"prediction-content"},{default:d(()=>[g(l,{class:"prediction-info"},{default:d(()=>[g(a,{class:"info-label"},{default:d(()=>[b("预测日期")]),_:1}),g(a,{class:"info-value"},{default:d(()=>[b(y(K.value.predictionDate),1)]),_:1})]),_:1}),g(l,{class:"prediction-info"},{default:d(()=>[g(a,{class:"info-label"},{default:d(()=>[b("您的预测")]),_:1}),g(a,{class:"info-value"},{default:d(()=>[b(y("bull"===K.value.prediction?"看多":"看空"),1)]),_:1})]),_:1}),g(l,{class:"prediction-info"},{default:d(()=>[g(a,{class:"info-label"},{default:d(()=>[b("实际涨跌")]),_:1}),g(a,{class:F(["info-value",{positive:K.value.actualChange>0,negative:K.value.actualChange<0}])},{default:d(()=>[b(y(K.value.actualChange>0?"+":"")+y(K.value.actualChange)+"% ",1)]),_:1},8,["class"])]),_:1}),g(l,{class:"prediction-info"},{default:d(()=>[g(a,{class:"info-label"},{default:d(()=>[b("预测结果")]),_:1}),g(a,{class:F(["info-value",{correct:K.value.isCorrect,wrong:!K.value.isCorrect}])},{default:d(()=>[b(y(K.value.isCorrect?"✅ 正确":"❌ 错误"),1)]),_:1},8,["class"])]),_:1})]),_:1}),g(l,{class:"prediction-explanation"},{default:d(()=>[g(a,{class:"explanation-text"},{default:d(()=>[b(y(K.value.explanation),1)]),_:1})]),_:1}),g(l,{class:"modal-footer"},{default:d(()=>[g(l,{class:"btn primary",onClick:q},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("继续训练")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0),B.value?(i(),c(l,{key:2,class:"modal-overlay"},{default:d(()=>[g(l,{class:"completion-modal",onClick:t[8]||(t[8]=S(()=>{},["stop"]))},{default:d(()=>[g(l,{class:"modal-header"},{default:d(()=>[g(a,{class:"modal-title"},{default:d(()=>[b("🎉 训练完成")]),_:1})]),_:1}),g(l,{class:"completion-content"},{default:d(()=>[g(a,{class:"completion-text"},{default:d(()=>[b("恭喜您完成了20天的交易训练！")]),_:1}),g(l,{class:"completion-stats"},{default:d(()=>[g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value"},{default:d(()=>[b(y(n.value.predictions),1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[b("总预测次数")]),_:1})]),_:1}),g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value"},{default:d(()=>[b(y(n.value.correctPredictions),1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[b("正确次数")]),_:1})]),_:1}),g(l,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value accent"},{default:d(()=>[b(y(n.value.accuracy||0)+"%",1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[b("准确率")]),_:1})]),_:1})]),_:1})]),_:1}),g(l,{class:"modal-footer"},{default:d(()=>[g(l,{class:"btn secondary",onClick:V},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("返回训练")]),_:1})]),_:1}),g(l,{class:"btn primary",onClick:Y},{default:d(()=>[g(a,{class:"btn-text"},{default:d(()=>[b("查看详情")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1})):f("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-ec7e1ffc"]]);export{A as default};
