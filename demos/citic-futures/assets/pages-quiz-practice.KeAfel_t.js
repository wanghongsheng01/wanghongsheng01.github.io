var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,t=Object.getOwnPropertySymbols,s=Object.prototype.hasOwnProperty,u=Object.prototype.propertyIsEnumerable,n=(a,l,t)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:t}):a[l]=t,o=(e,a)=>{for(var l in a||(a={}))s.call(a,l)&&n(e,l,a[l]);if(t)for(var l of t(a))u.call(a,l)&&n(e,l,a[l]);return e},r=(e,t)=>a(e,l(t)),i=(e,a,l)=>new Promise((t,s)=>{var u=e=>{try{o(l.next(e))}catch(a){s(a)}},n=e=>{try{o(l.throw(e))}catch(a){s(a)}},o=e=>e.done?t(e.value):Promise.resolve(e.value).then(u,n);o((l=l.apply(e,a)).next())});import{d as c,r as v,c as d,o as p,E as f,G as g,H as y,s as b,b as _,e as h,w as m,z as w,i as x,f as C,g as q,J as j,j as O,n as k,k as z,t as I,K as S,x as N,F as P,y as Q,l as A,q as D,C as E,L as G,M as T,D as $}from"./index-BWcxsYn8.js";import{N as B}from"./NavigationBar.BembfXLU.js";import{_ as F}from"./_plugin-vue_export-helper.BCo6x5W8.js";const H=F(c({__name:"practice",setup(e){const a=v(!1),l=v(null),t=v(0),s=v([]),u=v(!1),n=v(null),c=v([]),F=d(()=>{var e,a;const s=null==(e=l.value)?void 0:e.questions[t.value];return s?{id:s.id,question:s.question,questionImg:s.questionImg,type:0===s.questionType?"single":1===s.questionType?"multiple":"judge",options:(null==(a=s.options)?void 0:a.map(e=>e.optionContent))||[]}:null}),H=d(()=>{var e;return(null==(e=l.value)?void 0:e.questions.length)||0}),J=d(()=>H.value>0?(t.value+1)/H.value*100:0),K=d(()=>t.value===H.value-1);p(()=>{L()});const L=()=>{try{const e=f("currentQuizSession");if(!e)return void g({title:"提示",content:"未找到答题数据，请重新选择题目",showCancel:!1,success:()=>{y()}});l.value=e,t.value=e.currentIndex||0,c.value=e.answers||[]}catch(e){console.error("加载答题会话失败:",e),b({title:"加载失败",icon:"none"})}},M=e=>({single:"单选题",multiple:"多选题",judge:"判断题"}[e||""]||"未知题型"),R=e=>{var a;const s=null==(a=l.value)?void 0:a.questions[t.value];return(null==s?void 0:s.options)&&s.options[e]?s.options[e].optionCode:String.fromCharCode(65+e)},U=e=>{let a=[];if(s.value.includes(e)&&a.push("selected"),u.value&&n.value){(n.value.answerOption||"").includes(e)?a.push("correct"):s.value.includes(e)&&a.push("wrong")}return a.join(" ")},V=()=>i(this,null,function*(){var e;if(0!==s.value.length)try{a.value=!0;const t="multiple"===(null==(e=F.value)?void 0:e.type)?s.value.sort().join(""):s.value[0],o=yield D.submitQuizAnswer({batchNumber:l.value.batchNumber,batchSize:l.value.batchSize,questionClassify:l.value.categoryId,questionId:F.value.id,optionCode:t});if(0===o.code&&o.data){const e=t===o.data.answerOption;n.value={isCorrect:e,correctAnswer:o.data.answerOption,answerOption:o.data.answerOption,explanation:o.data.answerAnalysis||"暂无解析",studySuggest:o.data.studySuggest},u.value=!0,c.value.push({questionId:F.value.id,optionCode:t,isCorrect:e}),Y()}else b({title:o.msg||"提交失败",icon:"none"})}catch(t){console.error("提交答案失败:",t),b({title:"提交失败，请重试",icon:"none"})}finally{a.value=!1}}),W=()=>{K.value?X():(t.value++,s.value=[],u.value=!1,n.value=null,Y())},X=()=>i(this,null,function*(){try{E({title:"计算成绩中..."});const e=yield D.getQuizGrade(l.value.categoryId,l.value.batchNumber);0===e.code&&e.data?(w("quizResult",r(o({},e.data),{category:l.value.category,batchNumber:l.value.batchNumber})),G("currentQuizSession"),T({url:"/pages/quiz/result"})):b({title:e.msg||"获取成绩失败",icon:"none"})}catch(e){console.error("完成答题失败:",e),b({title:"计算成绩失败",icon:"none"})}finally{$()}}),Y=()=>{if(l.value){const e=r(o({},l.value),{currentIndex:t.value,answers:c.value});w("currentQuizSession",e)}},Z=()=>{var e;if(!n.value||!F.value)return"";const a=n.value.answerOption||"",s=null==(e=l.value)?void 0:e.questions[t.value];if(!(null==s?void 0:s.options))return a;const u=[];for(let l=0;l<a.length;l++){const e=a[l],t=s.options.find(a=>a.optionCode===e);t&&u.push(`${e}. ${t.optionContent}`)}return u.join("、")||a};return _(()=>{Y()}),(e,l)=>{const o=O,r=x,i=A;return C(),h(r,{class:"practice-page"},{default:m(()=>[q(B,{title:"练习答题"}),q(r,{class:"page-content"},{default:m(()=>[q(r,{class:"progress-bar"},{default:m(()=>[q(r,{class:"progress-info"},{default:m(()=>{var e,a;return[q(o,{class:k(["question-type",(a=null==(e=F.value)?void 0:e.type,{single:"single",multiple:"multiple",judge:"judge"}[a||""]||"")])},{default:m(()=>{var e;return[z(I(M(null==(e=F.value)?void 0:e.type)),1)]}),_:1},8,["class"]),q(o,{class:"progress-text"},{default:m(()=>[z(I(t.value+1)+"/"+I(H.value),1)]),_:1})]}),_:1}),q(r,{class:"progress-line"},{default:m(()=>[q(r,{class:"progress-fill",style:S({width:J.value+"%"})},null,8,["style"])]),_:1})]),_:1}),F.value?(C(),h(r,{key:0,class:"question-card"},{default:m(()=>[q(o,{class:"question-text"},{default:m(()=>[z(I(F.value.question),1)]),_:1}),q(r,{class:"options-container"},{default:m(()=>[(C(!0),N(P,null,Q(F.value.options,(e,a)=>(C(),h(i,{key:a,class:k(["option-btn",U(R(a))]),onClick:e=>(e=>{var a;if(!u.value)if("multiple"===(null==(a=F.value)?void 0:a.type)){const a=s.value.indexOf(e);a>-1?s.value.splice(a,1):s.value.push(e)}else s.value=[e]})(R(a)),disabled:u.value},{default:m(()=>[q(o,{class:"option-prefix"},{default:m(()=>[z(I(R(a)),1)]),_:2},1024),q(o,{class:"option-text"},{default:m(()=>[z(I(e),1)]),_:2},1024)]),_:2},1032,["class","onClick","disabled"]))),128))]),_:1}),u.value?j("",!0):(C(),h(i,{key:0,class:k(["submit-btn",{disabled:0===s.value.length}]),onClick:V,disabled:0===s.value.length},{default:m(()=>[z(" 提交答案 ")]),_:1},8,["class","disabled"]))]),_:1})):j("",!0),u.value&&n.value?(C(),h(r,{key:1,class:"result-card"},{default:m(()=>[q(r,{class:"result-header"},{default:m(()=>[q(o,{class:"result-title"},{default:m(()=>[z("答题结果")]),_:1}),q(r,{class:"result-status"},{default:m(()=>[q(o,{class:k(["status-icon",{correct:n.value.isCorrect,wrong:!n.value.isCorrect}])},{default:m(()=>[z(I(n.value.isCorrect?"✓":"✗"),1)]),_:1},8,["class"]),q(o,{class:k(["status-text",{correct:n.value.isCorrect,wrong:!n.value.isCorrect}])},{default:m(()=>[z(I(n.value.isCorrect?"恭喜你，答对了！":"很遗憾，答错了！"),1)]),_:1},8,["class"])]),_:1})]),_:1}),q(r,{class:"correct-answer"},{default:m(()=>[q(o,{class:"answer-label"},{default:m(()=>[z("正确答案：")]),_:1}),q(o,{class:"answer-text correct"},{default:m(()=>[z(I(Z()),1)]),_:1})]),_:1}),q(r,{class:"explanation"},{default:m(()=>[q(o,{class:"explanation-label"},{default:m(()=>[z("解析：")]),_:1}),q(o,{class:"explanation-text"},{default:m(()=>[z(I(n.value.explanation),1)]),_:1})]),_:1}),q(i,{class:"next-btn",onClick:W},{default:m(()=>[z(I(K.value?"查看成绩":"下一题"),1)]),_:1})]),_:1})):j("",!0),a.value?(C(),h(r,{key:2,class:"loading-container"},{default:m(()=>[q(o,{class:"loading-text"},{default:m(()=>[z("加载中...")]),_:1})]),_:1})):j("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-143de0f8"]]);export{H as default};
