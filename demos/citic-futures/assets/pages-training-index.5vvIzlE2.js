var a=(a,t,e)=>new Promise((l,s)=>{var n=a=>{try{o(e.next(a))}catch(t){s(t)}},i=a=>{try{o(e.throw(a))}catch(t){s(t)}},o=a=>a.done?l(a.value):Promise.resolve(a.value).then(n,i);o((e=e.apply(a,t)).next())});import{d as t,r as e,p as l,o as s,q as n,s as i,e as o,w as c,i as r,N as d,O as u,f,g as _,J as m,n as p,j as y,k as g,x as v,F as h,y as k,t as w,l as b,S as C,A as x,G as T}from"./index-BWcxsYn8.js";import{_ as j}from"./uni-popup.Q0R9iG8O.js";import{m as M}from"./mockApi.Dwynr1J8.js";import{C as $}from"./CustomTabBar.CiXty17D.js";import{N as A}from"./NavigationBar.BembfXLU.js";import{_ as I}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=I(t({__name:"index",setup(t){const I=e("training"),S=e([]),F=e([]),N=e(""),P=e(null),H=e(null),U=e(null),O=e([]),R=e([]),B=e(""),D=e([]),J=l({hotMarkets:!1,history:!1});function L(a){I.value=a,"history"===a&&0===F.value.length&&q()}function q(){return a(this,null,function*(){J.history=!0;try{const a=yield n.getTrainingHistory();0===a.code&&a.data&&Array.isArray(a.data)&&(F.value=a.data.map(a=>({id:a.id,symbol:`SYM${a.id.slice(-1)}`,name:a.title,lastUpdateTime:new Date(a.completedAt).toLocaleDateString(),progress:{current:Math.floor(a.accuracy/10),total:10},winRate:a.accuracy,status:a.score>80?"completed":"in_progress"})))}catch(a){console.error("加载训练历史失败:",a),i({title:"加载失败",icon:"error"})}finally{J.history=!1}})}function G(){var a;null==(a=H.value)||a.open()}function Y(){B.value="",D.value=[]}function z(){return a(this,null,function*(){try{const t={tradingStyle:B.value||void 0,categories:D.value.length>0?D.value:void 0};x({url:`/pages/training/search-result?filters=${encodeURIComponent(JSON.stringify(t))}`}),null==(a=H.value)||a.close()}catch(t){console.error("筛选失败:",t),i({title:"筛选失败",icon:"error"})}var a})}function E(){i({title:"功能开发中",icon:"none"})}function K(){var a;null==(a=U.value)||a.open()}function Q(){var a;null==(a=U.value)||a.close()}function V(){Q(),T({title:"确认重置",content:"确定要重置所有训练记录吗？此操作不可撤销。",confirmColor:"#667eea",success(t){return a(this,null,function*(){if(t.confirm)try{const a=F.value.map(a=>a.id);0===(yield n.manageTrainingHistory("reset",a)).code&&(i({title:"重置成功",icon:"success"}),q())}catch(a){i({title:"重置失败",icon:"error"})}})}})}function W(){Q(),T({title:"确认删除",content:"确定要删除所有训练记录吗？此操作不可撤销。",confirmColor:"#f44336",success(t){return a(this,null,function*(){if(t.confirm)try{const a=F.value.map(a=>a.id);0===(yield n.manageTrainingHistory("delete",a)).code&&(i({title:"删除成功",icon:"success"}),q())}catch(a){i({title:"删除失败",icon:"error"})}})}})}return s(()=>{!function(){a(this,null,function*(){try{const a=yield M.getUserProfile();200===a.code&&a.data&&(P.value=a.data,N.value=a.data.userInfo.avatar||"/static/images/default-avatar.svg")}catch(a){console.error("加载用户资料失败:",a),N.value="/static/images/default-avatar.svg"}})}(),function(){a(this,null,function*(){J.hotMarkets=!0;try{const a=yield n.getHotMarkets(10);0===a.code&&a.data&&Array.isArray(a.data)?S.value=a.data:(console.warn("热点行情数据格式不正确:",a),S.value=[])}catch(a){console.error("加载热点行情失败:",a),i({title:"加载失败",icon:"error"})}finally{J.hotMarkets=!1}})}(),function(){a(this,null,function*(){try{const a=yield n.getTrainingFilters();0===a.code&&a.data&&(O.value=[{id:"trend",name:"趋势交易",description:"适合趋势明显的行情"},{id:"swing",name:"震荡交易",description:"适合区间震荡的行情"}],R.value=a.data.category.map(a=>({id:a.id,name:a.name,description:`${a.name}相关训练`})))}catch(a){console.error("加载筛选配置失败:",a)}})}()}),(a,t)=>{const e=y,l=r,s=b,n=C,i=d(u("uni-popup"),j);return f(),o(l,{class:"training-page"},{default:c(()=>[_(A,{title:"训练"}),_(l,{class:"page-content"},{default:c(()=>[_(l,{class:"tab-container"},{default:c(()=>[_(l,{class:"tab-bar"},{default:c(()=>[_(l,{class:p(["tab-item",{active:"training"===I.value}]),onClick:t[0]||(t[0]=a=>L("training"))},{default:c(()=>[_(e,{class:"tab-text"},{default:c(()=>[g("交易训练")]),_:1})]),_:1},8,["class"]),_(l,{class:p(["tab-item",{active:"history"===I.value}]),onClick:t[1]||(t[1]=a=>L("history"))},{default:c(()=>[_(e,{class:"tab-text"},{default:c(()=>[g("训练历史")]),_:1})]),_:1},8,["class"])]),_:1})]),_:1}),"training"===I.value?(f(),o(l,{key:0,class:"training-content"},{default:c(()=>[_(l,{class:"header-section"},{default:c(()=>[_(l,{class:"page-title"},{default:c(()=>[_(e,{class:"title"},{default:c(()=>[g("交易训练")]),_:1})]),_:1}),_(l,{class:"training-methods"},{default:c(()=>[_(l,{class:"method-item",onClick:G},{default:c(()=>[_(l,{class:"method-icon fa-icon filter-icon"}),_(e,{class:"method-text"},{default:c(()=>[g("行情筛选")]),_:1})]),_:1}),_(l,{class:"method-item secondary",onClick:E},{default:c(()=>[_(l,{class:"method-icon fa-icon style-icon"}),_(e,{class:"method-text"},{default:c(()=>[g("风格匹配")]),_:1})]),_:1})]),_:1})]),_:1}),_(l,{class:"hot-markets-section"},{default:c(()=>[_(l,{class:"section-title"},{default:c(()=>[_(e,{class:"title-text"},{default:c(()=>[g("热点行情")]),_:1})]),_:1}),_(l,{class:"markets-list"},{default:c(()=>[J.hotMarkets?(f(),o(l,{key:0,class:"loading-container"},{default:c(()=>[(f(),v(h,null,k(2,a=>_(l,{class:"skeleton-card",key:a},{default:c(()=>[_(l,{class:"skeleton-line"}),_(l,{class:"skeleton-line short"})]),_:2},1024)),64))]),_:1})):(f(!0),v(h,{key:1},k(S.value,a=>(f(),o(l,{key:a.id,class:"market-item",onClick:t=>{return e=a.id,void x({url:`/pages/training/detail?marketId=${e}`});var e}},{default:c(()=>[_(l,{class:"market-row"},{default:c(()=>[_(l,{class:"market-title-section"},{default:c(()=>[_(e,{class:"market-symbol"},{default:c(()=>[g(w(a.tradeCodeCn),1)]),_:2},1024),_(e,{class:p(["market-type","type-"+(0===a.tradeType?"trend":"swing")])},{default:c(()=>[g(w(a.tradeTypeName),1)]),_:2},1032,["class"])]),_:2},1024),_(l,{class:"market-arrow"},{default:c(()=>[_(e,{class:"arrow-icon"},{default:c(()=>[g("›")]),_:1})]),_:1})]),_:2},1024),_(l,{class:"market-data"},{default:c(()=>[_(l,{class:"data-item"},{default:c(()=>[_(e,{class:"data-label"},{default:c(()=>[g("波动率")]),_:1}),_(e,{class:"data-value"},{default:c(()=>[g(w((100*a.volatility).toFixed(2))+"%",1)]),_:2},1024)]),_:2},1024),_(l,{class:"data-item"},{default:c(()=>[_(e,{class:"data-label"},{default:c(()=>[g("趋势强度")]),_:1}),_(e,{class:"data-value trend"},{default:c(()=>[g(w(a.trend?a.trend.toFixed(1):"--"),1)]),_:2},1024)]),_:2},1024),_(l,{class:"data-item"},{default:c(()=>[_(e,{class:"data-label"},{default:c(()=>[g("成交量")]),_:1}),_(e,{class:"data-value"},{default:c(()=>{return[g(w((t=a.volume,t>=1e4?(t/1e4).toFixed(1)+"万":t.toString())),1)];var t}),_:2},1024)]),_:2},1024),_(l,{class:"data-item"},{default:c(()=>[_(e,{class:"data-label"},{default:c(()=>[g("训练天数")]),_:1}),_(e,{class:"data-value"},{default:c(()=>[g(w(a.dateLength)+"天",1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1032,["onClick"]))),128)),J.hotMarkets||0!==S.value.length?m("",!0):(f(),o(l,{key:2,class:"empty-state"},{default:c(()=>[_(e,{class:"empty-text"},{default:c(()=>[g("暂无热点行情")]),_:1})]),_:1}))]),_:1})]),_:1})]),_:1})):m("",!0),"history"===I.value?(f(),o(l,{key:1,class:"history-content"},{default:c(()=>[_(l,{class:"history-header"},{default:c(()=>[_(l,{class:"history-title"},{default:c(()=>[_(e,{class:"title-text"},{default:c(()=>[g("训练历史")]),_:1})]),_:1}),_(s,{class:"manage-btn",onClick:K},{default:c(()=>[_(l,{class:"btn-icon fa-icon manage-icon-fa"}),_(e,{class:"btn-text"},{default:c(()=>[g("管理")]),_:1})]),_:1})]),_:1}),J.history?(f(),o(l,{key:0,class:"loading-container"},{default:c(()=>[(f(),v(h,null,k(3,a=>_(l,{class:"skeleton-card",key:a},{default:c(()=>[_(l,{class:"skeleton-line"}),_(l,{class:"skeleton-line short"})]),_:2},1024)),64))]),_:1})):(f(),o(l,{key:1,class:"history-list"},{default:c(()=>[(f(!0),v(h,null,k(F.value,a=>(f(),o(l,{key:a.id,class:p(["history-item",`status-${a.status}`]),onClick:t=>function(a){"completed"===a.status?T({title:"提示",content:"训练已完成，是否查看详情？",success(t){t.confirm&&x({url:`/pages/training/detail?marketId=${a.id}&mode=review`})}}):x({url:`/pages/training/detail?marketId=${a.id}&mode=continue`})}(a)},{default:c(()=>[_(l,{class:"training-info"},{default:c(()=>[_(e,{class:"training-name"},{default:c(()=>[g(w(a.symbol)+" "+w(a.name),1)]),_:2},1024),_(e,{class:"training-time"},{default:c(()=>[g(w(a.lastUpdateTime),1)]),_:2},1024)]),_:2},1024),_(l,{class:"training-stats"},{default:c(()=>[_(l,{class:"progress-info"},{default:c(()=>[_(e,{class:"progress-text"},{default:c(()=>[g("进度 "+w(a.progress.current)+"/"+w(a.progress.total),1)]),_:2},1024),_(e,{class:"winrate-text"},{default:c(()=>[g("胜率 "+w(a.winRate)+"%",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),_(l,{class:p(["status-badge",`badge-${a.status}`])},{default:c(()=>[_(e,{class:"status-text"},{default:c(()=>[g(w("completed"===a.status?"已完成":"in_progress"===a.status?"进行中":"未完成"),1)]),_:2},1024)]),_:2},1032,["class"])]),_:2},1032,["class","onClick"]))),128))]),_:1}))]),_:1})):m("",!0),_(i,{ref_key:"filterPopup",ref:H,type:"bottom","background-color":"transparent"},{default:c(()=>[_(n,{class:"filter-drawer-wrapper","scroll-y":"","show-scrollbar":!0},{default:c(()=>[_(l,{class:"filter-drawer"},{default:c(()=>[_(l,{class:"drawer-header"},{default:c(()=>[_(e,{class:"drawer-title"},{default:c(()=>[g("行情筛选")]),_:1}),_(l,{class:"header-divider"})]),_:1}),_(l,{class:"filter-content"},{default:c(()=>[_(l,{class:"filter-section"},{default:c(()=>[_(e,{class:"filter-label"},{default:c(()=>[g("交易风格")]),_:1}),_(l,{class:"filter-options"},{default:c(()=>[(f(!0),v(h,null,k(O.value,a=>(f(),o(l,{key:a.id,class:p(["filter-option",{selected:B.value===a.id}]),onClick:t=>{return e=a.id,void(B.value=e);var e}},{default:c(()=>[_(e,{class:"option-text"},{default:c(()=>[g(w(a.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),_(l,{class:"filter-section"},{default:c(()=>[_(e,{class:"filter-label"},{default:c(()=>[g("交易品类")]),_:1}),_(l,{class:"filter-options multi"},{default:c(()=>[(f(!0),v(h,null,k(R.value,a=>(f(),o(l,{key:a.id,class:p(["filter-option",{selected:D.value.includes(a.id)}]),onClick:t=>function(a){const t=D.value.indexOf(a);t>-1?D.value.splice(t,1):D.value.push(a)}(a.id)},{default:c(()=>[_(e,{class:"option-text"},{default:c(()=>[g(w(a.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),_(l,{class:"drawer-footer"},{default:c(()=>[_(s,{class:"drawer-btn secondary",onClick:Y},{default:c(()=>[g("重置")]),_:1}),_(s,{class:"drawer-btn primary",onClick:z},{default:c(()=>[g("确定筛选")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512),_(i,{ref_key:"managePopup",ref:U,type:"bottom","background-color":"transparent"},{default:c(()=>[_(n,{class:"manage-drawer-wrapper","scroll-y":"","show-scrollbar":!0},{default:c(()=>[_(l,{class:"manage-drawer"},{default:c(()=>[_(l,{class:"drawer-header"},{default:c(()=>[_(e,{class:"drawer-title"},{default:c(()=>[g("训练管理")]),_:1}),_(l,{class:"header-divider"})]),_:1}),_(l,{class:"manage-options"},{default:c(()=>[_(s,{class:"manage-option",onClick:V},{default:c(()=>[_(l,{class:"option-icon-wrapper"},{default:c(()=>[_(l,{class:"option-icon fa-icon reset-icon"})]),_:1}),_(l,{class:"option-info"},{default:c(()=>[_(e,{class:"option-title"},{default:c(()=>[g("重置训练")]),_:1}),_(e,{class:"option-desc"},{default:c(()=>[g("重置所有训练记录的进度")]),_:1})]),_:1}),_(l,{class:"option-arrow"},{default:c(()=>[g("›")]),_:1})]),_:1}),_(s,{class:"manage-option danger",onClick:W},{default:c(()=>[_(l,{class:"option-icon-wrapper danger-bg"},{default:c(()=>[_(l,{class:"option-icon fa-icon delete-icon"})]),_:1}),_(l,{class:"option-info"},{default:c(()=>[_(e,{class:"option-title"},{default:c(()=>[g("删除训练")]),_:1}),_(e,{class:"option-desc"},{default:c(()=>[g("删除所有训练记录")]),_:1})]),_:1}),_(l,{class:"option-arrow"},{default:c(()=>[g("›")]),_:1})]),_:1})]),_:1}),_(s,{class:"cancel-btn",onClick:Q},{default:c(()=>[g(" 取消 ")]),_:1})]),_:1})]),_:1})]),_:1},512),_($)]),_:1})]),_:1})}}}),[["__scopeId","data-v-11894a75"]]);export{S as default};
