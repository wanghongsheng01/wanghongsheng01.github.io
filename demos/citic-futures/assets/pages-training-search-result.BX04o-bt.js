var a=(a,e,t)=>new Promise((l,s)=>{var c=a=>{try{n(t.next(a))}catch(e){s(e)}},r=a=>{try{n(t.throw(a))}catch(e){s(e)}},n=a=>a.done?l(a.value):Promise.resolve(a.value).then(c,r);n((t=t.apply(a,e)).next())});import{d as e,r as t,c as l,V as s,o as c,q as r,s as n,e as i,w as u,i as d,N as o,O as f,f as _,g as v,j as m,k as p,n as h,J as g,t as y,x as k,F as b,y as w,l as P,A as x}from"./index-BWcxsYn8.js";import{_ as D}from"./uni-popup.Q0R9iG8O.js";import{_ as C}from"./_plugin-vue_export-helper.BCo6x5W8.js";const S=C(e({__name:"search-result",setup(e){const C=t([]),S=t(!1),M=t("startDate"),j=t("desc"),F=t(null),I=t([]),O=t([]),$=t(""),T=t([]),A=t({}),J=l(()=>[...C.value].sort((a,e)=>{let t=0;return"startDate"===M.value?t=new Date(a.startDate).getTime()-new Date(e.startDate).getTime():"changePercent"===M.value&&(t=Math.abs(a.changePercent)-Math.abs(e.changePercent)),"asc"===j.value?t:-t}));function N(a){return a.toFixed(2)}function q(a){M.value===a?j.value="asc"===j.value?"desc":"asc":(M.value=a,j.value="desc")}function R(){return a(this,null,function*(){S.value=!0;try{const a=yield r.searchTrainingMarkets(A.value);200===a.code&&a.data&&Array.isArray(a.data)?C.value=a.data.map(a=>{const e=100*Math.random()+2400,t=3*Math.random()+1,l=6*(Math.random()-.5),s=new Date,c=new Date(Date.now()+864e5);return{id:a.id,symbol:`SYM${a.id.slice(-1)}`,name:a.title,type:Math.random()>.5?"trend":"swing",category:a.category,duration:a.duration,startDate:s.toISOString().slice(0,10),trainStartDate:c.toISOString().slice(0,10),currentPrice:e,highPrice:e*(1+t/100),lowPrice:e*(1-t/100),volatility:t,changePercent:l,volume:"1.2万手",trendStrength:100*Math.random()}}):C.value=[]}catch(a){console.error("加载市场数据失败:",a),n({title:"加载失败",icon:"error"})}finally{S.value=!1}})}function U(){var a;null==(a=F.value)||a.open()}function V(){$.value="",T.value=[]}function Y(){return a(this,null,function*(){const a={tradingStyle:$.value||void 0,categories:T.value.length>0?T.value:void 0};var e;A.value=a,null==(e=F.value)||e.close(),yield R(),n({title:"筛选已更新",icon:"success"})})}return s(a=>{if(a.filters)try{const e=JSON.parse(decodeURIComponent(a.filters));A.value=e,$.value=e.tradingStyle||"",T.value=e.categories||[]}catch(e){console.error("解析筛选条件失败:",e)}}),c(()=>{!function(){a(this,null,function*(){try{const a=yield r.getTrainingFilters();200===a.code&&a.data&&(I.value=[{id:"trend",name:"趋势交易",description:"适合趋势明显的行情"},{id:"swing",name:"震荡交易",description:"适合区间震荡的行情"}],O.value=a.data.category.map(a=>({id:a.id,name:a.name,description:`${a.name}相关训练`})))}catch(a){console.error("加载筛选配置失败:",a)}})}(),R()}),(a,e)=>{const t=m,l=d,s=P,c=o(f("uni-popup"),D);return _(),i(l,{class:"search-result-page"},{default:u(()=>[v(l,{class:"filter-bar"},{default:u(()=>[v(l,{class:"filter-group"},{default:u(()=>[v(t,{class:"filter-label"},{default:u(()=>[p("排序：")]),_:1}),v(l,{class:"filter-options"},{default:u(()=>[v(l,{class:h(["filter-chip",{active:"startDate"===M.value}]),onClick:e[0]||(e[0]=a=>q("startDate"))},{default:u(()=>[v(t,{class:"chip-text"},{default:u(()=>[p("行情开始")]),_:1}),"startDate"===M.value?(_(),i(l,{key:0,class:"sort-icon"},{default:u(()=>[v(t,{class:"icon"},{default:u(()=>[p(y("asc"===j.value?"↑":"↓"),1)]),_:1})]),_:1})):g("",!0)]),_:1},8,["class"]),v(l,{class:h(["filter-chip",{active:"changePercent"===M.value}]),onClick:e[1]||(e[1]=a=>q("changePercent"))},{default:u(()=>[v(t,{class:"chip-text"},{default:u(()=>[p("涨跌幅")]),_:1}),"changePercent"===M.value?(_(),i(l,{key:0,class:"sort-icon"},{default:u(()=>[v(t,{class:"icon"},{default:u(()=>[p(y("asc"===j.value?"↑":"↓"),1)]),_:1})]),_:1})):g("",!0)]),_:1},8,["class"])]),_:1})]),_:1}),v(l,{class:"filter-count"},{default:u(()=>[v(t,{class:"count-text"},{default:u(()=>[p("共 "+y(C.value.length)+" 条",1)]),_:1})]),_:1})]),_:1}),S.value?(_(),i(l,{key:0,class:"loading-container"},{default:u(()=>[(_(),k(b,null,w(3,a=>v(l,{class:"skeleton-card",key:a},{default:u(()=>[v(l,{class:"skeleton-line"}),v(l,{class:"skeleton-line short"}),v(l,{class:"skeleton-line"})]),_:2},1024)),64))]),_:1})):0===C.value.length?(_(),i(l,{key:1,class:"empty-container"},{default:u(()=>[v(l,{class:"empty-icon"},{default:u(()=>[p("📈")]),_:1}),v(t,{class:"empty-text"},{default:u(()=>[p("暂无符合条件的行情")]),_:1}),v(t,{class:"empty-hint"},{default:u(()=>[p("请尝试调整筛选条件")]),_:1})]),_:1})):(_(),i(l,{key:2,class:"markets-container"},{default:u(()=>[(_(!0),k(b,null,w(J.value,a=>(_(),i(l,{key:a.id,class:h(["market-card",`market-${a.type}`]),onClick:e=>{return t=a.id,void x({url:`/pages/training/detail?marketId=${t}`});var t}},{default:u(()=>[v(l,{class:"market-header"},{default:u(()=>[v(l,{class:"market-info"},{default:u(()=>[v(t,{class:"market-symbol"},{default:u(()=>[p(y(a.symbol),1)]),_:2},1024),v(t,{class:"market-name"},{default:u(()=>[p(y(a.name),1)]),_:2},1024)]),_:2},1024),v(l,{class:"market-tags"},{default:u(()=>[v(t,{class:h(["tag type",`tag-${a.type}`])},{default:u(()=>[p(y("trend"===a.type?"趋势":"震荡"),1)]),_:2},1032,["class"]),v(t,{class:"tag duration"},{default:u(()=>[p(y(a.duration)+"天",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),v(l,{class:"price-stats"},{default:u(()=>[v(l,{class:"stat-row"},{default:u(()=>[v(l,{class:"stat-item main"},{default:u(()=>[v(t,{class:"stat-label"},{default:u(()=>[p("最新价")]),_:1}),v(t,{class:"stat-value price"},{default:u(()=>[p(y(N(a.currentPrice)),1)]),_:2},1024)]),_:2},1024),v(l,{class:"stat-item"},{default:u(()=>[v(t,{class:"stat-label"},{default:u(()=>[p("涨跌幅")]),_:1}),v(t,{class:h(["stat-value",{positive:a.changePercent>0,negative:a.changePercent<0}])},{default:u(()=>{return[p(y(a.changePercent>0?"+":"")+y((e=a.changePercent,e.toFixed(2)))+"% ",1)];var e}),_:2},1032,["class"])]),_:2},1024)]),_:2},1024),v(l,{class:"stat-row secondary"},{default:u(()=>[v(l,{class:"stat-item"},{default:u(()=>[v(t,{class:"stat-label"},{default:u(()=>[p("最高")]),_:1}),v(t,{class:"stat-value"},{default:u(()=>[p(y(N(a.highPrice)),1)]),_:2},1024)]),_:2},1024),v(l,{class:"stat-item"},{default:u(()=>[v(t,{class:"stat-label"},{default:u(()=>[p("最低")]),_:1}),v(t,{class:"stat-value"},{default:u(()=>[p(y(N(a.lowPrice)),1)]),_:2},1024)]),_:2},1024),v(l,{class:"stat-item"},{default:u(()=>[v(t,{class:"stat-label"},{default:u(()=>[p("波动率")]),_:1}),v(t,{class:"stat-value"},{default:u(()=>{return[p(y((e=a.volatility,e.toFixed(1)))+"%",1)];var e}),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),v(l,{class:"time-info"},{default:u(()=>[v(l,{class:"time-item"},{default:u(()=>[v(l,{class:"time-icon"},{default:u(()=>[p("📅")]),_:1}),v(l,{class:"time-content"},{default:u(()=>[v(t,{class:"time-label"},{default:u(()=>[p("行情开始")]),_:1}),v(t,{class:"time-value"},{default:u(()=>[p(y(a.startDate),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),v(l,{class:"time-item"},{default:u(()=>[v(l,{class:"time-icon"},{default:u(()=>[p("🎯")]),_:1}),v(l,{class:"time-content"},{default:u(()=>[v(t,{class:"time-label"},{default:u(()=>[p("训练起始")]),_:1}),v(t,{class:"time-value"},{default:u(()=>[p(y(a.trainStartDate),1)]),_:2},1024)]),_:2},1024)]),_:2},1024)]),_:2},1024),v(l,{class:"action-btn"},{default:u(()=>[v(t,{class:"btn-text"},{default:u(()=>[p("开始训练")]),_:1}),v(t,{class:"arrow-icon"},{default:u(()=>[p("›")]),_:1})]),_:1})]),_:2},1032,["class","onClick"]))),128))]),_:1})),v(l,{class:"fab",onClick:U},{default:u(()=>[v(l,{class:"fab-icon fa-icon filter-icon"})]),_:1}),v(c,{ref_key:"filterPopup",ref:F,type:"bottom","background-color":"transparent"},{default:u(()=>[v(l,{class:"filter-drawer-wrapper"},{default:u(()=>[v(l,{class:"filter-drawer"},{default:u(()=>[v(l,{class:"drawer-header"},{default:u(()=>[v(t,{class:"drawer-title"},{default:u(()=>[p("筛选条件")]),_:1}),v(l,{class:"header-divider"})]),_:1}),v(l,{class:"filter-content"},{default:u(()=>[v(l,{class:"filter-section"},{default:u(()=>[v(t,{class:"filter-label"},{default:u(()=>[p("交易风格")]),_:1}),v(l,{class:"filter-options"},{default:u(()=>[(_(!0),k(b,null,w(I.value,a=>(_(),i(l,{key:a.id,class:h(["filter-option",{selected:$.value===a.id}]),onClick:e=>{return t=a.id,void($.value=$.value===t?"":t);var t}},{default:u(()=>[v(t,{class:"option-text"},{default:u(()=>[p(y(a.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1}),v(l,{class:"filter-section"},{default:u(()=>[v(t,{class:"filter-label"},{default:u(()=>[p("交易品类")]),_:1}),v(l,{class:"filter-options multi"},{default:u(()=>[(_(!0),k(b,null,w(O.value,a=>(_(),i(l,{key:a.id,class:h(["filter-option",{selected:T.value.includes(a.id)}]),onClick:e=>function(a){const e=T.value.indexOf(a);e>-1?T.value.splice(e,1):T.value.push(a)}(a.id)},{default:u(()=>[v(t,{class:"option-text"},{default:u(()=>[p(y(a.name),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})]),_:1})]),_:1}),v(l,{class:"drawer-footer"},{default:u(()=>[v(s,{class:"drawer-btn secondary",onClick:V},{default:u(()=>[p("重置")]),_:1}),v(s,{class:"drawer-btn primary",onClick:Y},{default:u(()=>[p("应用")]),_:1})]),_:1})]),_:1})]),_:1})]),_:1},512)]),_:1})}}}),[["__scopeId","data-v-956124a8"]]);export{S as default};
