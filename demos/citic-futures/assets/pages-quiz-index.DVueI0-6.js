var a=(a,t,e)=>new Promise((s,l)=>{var c=a=>{try{n(e.next(a))}catch(t){l(t)}},o=a=>{try{n(e.throw(a))}catch(t){l(t)}},n=a=>a.done?s(a.value):Promise.resolve(a.value).then(c,o);n((e=e.apply(a,t)).next())});import{d as t,p as e,r as s,o as l,q as c,s as o,e as n,w as r,v as i,i as u,f as d,g as f,j as y,k as g,l as _,t as m,x as h,F as b,y as p,n as k,C as v,z as w,A as C,D as x}from"./index-BWcxsYn8.js";import{C as z}from"./CustomTabBar.CiXty17D.js";import{N as S}from"./NavigationBar.BembfXLU.js";import{_ as q}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=q(t({__name:"index",setup(t,{expose:q}){const I=e({stats:!0,categories:!0}),R=s({totalAnswered:0,totalCorrect:0,accuracy:0,categoryStats:[]}),L={0:"fas fa-book",1:"fas fa-graduation-cap",2:"fas fa-robot",3:"fas fa-random"},N={0:"blue",1:"green",2:"yellow",3:"red"},j=s([]);l(()=>a(this,null,function*(){yield Promise.all([A(),P()])}));const A=()=>a(this,null,function*(){try{I.stats=!0;const a=yield c.getQuizStats();if(0===a.code&&a.data){const t=a.data;R.value={totalAnswered:t.answerRecordTotal||0,totalCorrect:t.answerCorrectRecordTotal||0,accuracy:t.accuracyRate?Math.round(100*t.accuracyRate):0,categoryStats:(t.classifyList||[]).map(a=>({categoryId:a.id,correct:a.answerCorrectRecordTotal||0,total:a.answerRecordTotal||0}))},t.classifyList&&t.classifyList.length>0&&(j.value=t.classifyList.map(a=>({id:a.id,name:a.name,description:a.description,icon:L[a.id]||"fas fa-book",color:N[a.id]||"blue"})))}}catch(a){console.error("加载答题统计失败:",a),o({title:"加载统计失败",icon:"none"})}finally{I.stats=!1}}),P=()=>a(this,null,function*(){I.categories=!1}),Q=a=>{if(!R.value.categoryStats)return"0/0";const t=R.value.categoryStats.find(t=>t.categoryId===a);return t?`${t.correct}/${t.total}`:"0/0"},T=t=>a(this,null,function*(){if(2!==t.id&&"AI问答"!==t.name)try{v({title:"准备题目中..."});const a=yield c.getQuestionsByClassify(t.id);if(0===a.code&&a.data){const e=a.data;w("currentQuizSession",{batchNumber:e.batchNumber,batchSize:e.batchSize,questions:e.questionsList,category:t.name,categoryId:t.id,currentIndex:0,answers:[]}),C({url:"/pages/quiz/practice"})}else o({title:a.msg||"获取题目失败",icon:"none"})}catch(a){console.error("获取题目失败:",a),o({title:"获取题目失败，请重试",icon:"none"})}finally{x()}else try{v({title:"准备题目中..."});const a=yield c.getQuestionsByClassify(t.id);if(0===a.code&&a.data){const e=a.data;w("currentQuizSession",{batchNumber:e.batchNumber,batchSize:e.batchSize,questions:e.questionsList,category:t.name,categoryId:t.id,currentIndex:0,answers:[]}),C({url:"/pages/quiz/ai-chat"})}else o({title:a.msg||"获取题目失败",icon:"none"})}catch(a){console.error("获取题目失败:",a),o({title:"获取题目失败，请重试",icon:"none"})}finally{x()}}),B=()=>{C({url:"/pages/quiz/wrong-book"})};return q({onPullDownRefresh:()=>a(this,null,function*(){try{yield Promise.all([A(),P()]),o({title:"刷新成功",icon:"success"})}catch(a){o({title:"刷新失败",icon:"none"})}finally{i()}})}),(a,t)=>{const e=y,s=u,l=_;return d(),n(s,{class:"quiz-page"},{default:r(()=>[f(S,{title:"知识问答"}),f(s,{class:"page-content"},{default:r(()=>[f(s,{class:"page-header"},{default:r(()=>[f(s,{class:"header-info"},{default:r(()=>[f(e,{class:"page-title"},{default:r(()=>[g("知识问答")]),_:1}),f(e,{class:"page-subtitle"},{default:r(()=>[g("专业的期货交易知识学习平台")]),_:1})]),_:1}),f(l,{class:"wrong-book-btn",onClick:B},{default:r(()=>[f(e,{class:"icon fas fa-book-open"}),f(e,null,{default:r(()=>[g("错题本")]),_:1})]),_:1})]),_:1}),I.stats?(d(),n(s,{key:1,class:"stats-card loading"},{default:r(()=>[(d(),h(b,null,p(3,a=>f(s,{class:"stat-item",key:a},{default:r(()=>[f(s,{class:"skeleton skeleton-value"}),f(e,{class:"stat-label"},{default:r(()=>[g("加载中...")]),_:1})]),_:2},1024)),64))]),_:1})):(d(),n(s,{key:0,class:"stats-card"},{default:r(()=>[f(s,{class:"stat-item"},{default:r(()=>[f(e,{class:"stat-value"},{default:r(()=>[g(m(R.value.totalAnswered),1)]),_:1}),f(e,{class:"stat-label"},{default:r(()=>[g("已答题数")]),_:1})]),_:1}),f(s,{class:"stat-item"},{default:r(()=>[f(e,{class:"stat-value"},{default:r(()=>[g(m(R.value.totalCorrect),1)]),_:1}),f(e,{class:"stat-label"},{default:r(()=>[g("答对题数")]),_:1})]),_:1}),f(s,{class:"stat-item"},{default:r(()=>[f(e,{class:"stat-value"},{default:r(()=>[g(m(R.value.accuracy)+"%",1)]),_:1}),f(e,{class:"stat-label"},{default:r(()=>[g("正确率")]),_:1})]),_:1})]),_:1})),f(s,{class:"section-title"},{default:r(()=>[f(e,{class:"title-text"},{default:r(()=>[g("选择训练类型")]),_:1})]),_:1}),I.categories?(d(),n(s,{key:3,class:"category-grid loading"},{default:r(()=>[(d(),h(b,null,p(4,a=>f(s,{class:"category-item skeleton-card",key:a},{default:r(()=>[f(s,{class:"category-header"},{default:r(()=>[f(s,{class:"skeleton skeleton-icon"}),f(s,{class:"skeleton skeleton-badge"})]),_:1}),f(s,{class:"skeleton skeleton-desc"})]),_:2},1024)),64))]),_:1})):(d(),n(s,{key:2,class:"category-grid"},{default:r(()=>[(d(!0),h(b,null,p(j.value,a=>(d(),n(s,{key:a.id,class:k(["category-item",a.color]),onClick:t=>T(a)},{default:r(()=>[f(s,{class:"category-header"},{default:r(()=>[f(s,{class:"category-info"},{default:r(()=>[f(e,{class:k(["category-icon",a.icon])},null,8,["class"]),f(e,{class:"category-name"},{default:r(()=>[g(m(a.name),1)]),_:2},1024)]),_:2},1024),f(s,{class:"category-badge"},{default:r(()=>[f(e,{class:"badge-text"},{default:r(()=>[g(m(Q(a.id)),1)]),_:2},1024)]),_:2},1024)]),_:2},1024),f(e,{class:"category-desc"},{default:r(()=>[g(m(a.description),1)]),_:2},1024)]),_:2},1032,["class","onClick"]))),128))]),_:1})),f(z)]),_:1})]),_:1})}}}),[["__scopeId","data-v-81d89a74"]]);export{I as default};
