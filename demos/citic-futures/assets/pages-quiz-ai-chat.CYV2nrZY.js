var e=Object.defineProperty,a=Object.defineProperties,l=Object.getOwnPropertyDescriptors,s=Object.getOwnPropertySymbols,t=Object.prototype.hasOwnProperty,n=Object.prototype.propertyIsEnumerable,u=(a,l,s)=>l in a?e(a,l,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[l]=s;import{d as o,r,c as i,o as c,E as d,G as v,H as p,s as f,e as _,w as g,i as y,f as b,g as h,J as w,j as m,k as C,t as I,K as x,x as A,F as q,y as O,l as j,n as k,q as z,z as S}from"./index-BWcxsYn8.js";import{N as P}from"./NavigationBar.BembfXLU.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const $=N(o({__name:"ai-chat",setup(e){const o=r(!1),N=r("AI正在分析..."),$=r(null),Q=r(0),E=r(null),M=r(!1),T=r(null),B=r([]),D=i(()=>{var e,a;const l=null==(e=$.value)?void 0:e.questions[Q.value];return l?{id:l.id,question:l.question,options:(null==(a=l.options)?void 0:a.map(e=>e.optionContent))||[],type:0===l.questionType?"single":1===l.questionType?"multiple":"judge"}:null}),F=i(()=>{var e;return(null==(e=$.value)?void 0:e.questions.length)||0}),G=i(()=>F.value>0?(Q.value+1)/F.value*100:0),H=i(()=>Q.value===F.value-1),J=i(()=>null!==E.value);c(()=>{K()});const K=()=>{try{const e=d("currentQuizSession");if(!e)return void v({title:"提示",content:"未找到答题数据，请重新选择题目",showCancel:!1,success:()=>{p()}});$.value=e,Q.value=e.currentIndex||0,B.value=e.answers||[]}catch(e){console.error("加载答题会话失败:",e),f({title:"加载失败",icon:"none"})}},L=e=>{var a;const l=null==(a=$.value)?void 0:a.questions[Q.value];return(null==l?void 0:l.options)&&l.options[e]?l.options[e].optionCode:String.fromCharCode(65+e)},R=e=>L(e)+".",U=e=>{let a=[];const l=L(e);return E.value===l&&a.push("selected"),M.value&&T.value&&(T.value.answerOption===l?a.push("correct"):E.value===l&&a.push("wrong")),a.join(" ")},V=()=>{return e=this,a=null,l=function*(){var e,a,l,s;if(null!==E.value)try{o.value=!0,N.value="AI正在分析...",console.log("提交答题数据:",{batchNumber:null==(e=$.value)?void 0:e.batchNumber,batchSize:null==(a=$.value)?void 0:a.batchSize,questionClassify:null==(l=$.value)?void 0:l.categoryId,questionId:null==(s=D.value)?void 0:s.id,optionCode:E.value});const t=yield z.submitQuizAnswer({batchNumber:$.value.batchNumber,batchSize:$.value.batchSize,questionClassify:$.value.categoryId,questionId:D.value.id,optionCode:E.value});if(0===t.code&&t.data){const e=E.value===t.data.answerOption;T.value={isCorrect:e,correctAnswer:t.data.answerOption,answerOption:t.data.answerOption,explanation:t.data.answerAnalysis||"暂无解析",successMessage:e?"回答正确！AI分析准确":"很遗憾，答错了！",learningAdvice:t.data.studySuggest||""},M.value=!0,B.value.push({questionId:D.value.id,optionCode:E.value,isCorrect:e}),W()}else console.error("AI分析失败:",t),v({title:"AI分析失败",content:`错误信息：${t.msg||"未知错误"}\n错误代码：${t.code}`,showCancel:!1})}catch(t){console.error("AI分析失败:",t),v({title:"请求失败",content:(null==t?void 0:t.message)||"AI分析失败，请检查网络连接后重试",showCancel:!1})}finally{o.value=!1}else f({title:"请先选择答案",icon:"none"})},new Promise((s,t)=>{var n=e=>{try{o(l.next(e))}catch(a){t(a)}},u=e=>{try{o(l.throw(e))}catch(a){t(a)}},o=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,u);o((l=l.apply(e,a)).next())});var e,a,l},W=()=>{try{const r=(e=((e,a)=>{for(var l in a||(a={}))t.call(a,l)&&u(e,l,a[l]);if(s)for(var l of s(a))n.call(a,l)&&u(e,l,a[l]);return e})({},$.value),o={currentIndex:Q.value,answers:B.value},a(e,l(o)));S("currentQuizSession",r)}catch(r){console.error("更新会话存储失败:",r)}var e,o},X=()=>{H.value?Y():(Q.value++,E.value=null,M.value=!1,T.value=null,W())},Y=()=>{v({title:"练习完成",content:"AI问答练习已完成！",showCancel:!1,success:()=>{o.value=!1,M.value=!1,T.value=null,p()}})},Z=()=>{var e;if(!T.value||!D.value)return"";const a=T.value.answerOption||"",l=null==(e=$.value)?void 0:e.questions[Q.value];if(!(null==l?void 0:l.options))return a;const s=[];for(let t=0;t<a.length;t++){const e=a[t],n=l.options.find(a=>a.optionCode===e);n&&s.push(`${e}. ${n.optionContent}`)}return s.join("、")||a};return(e,a)=>{const l=m,s=y,t=j;return b(),_(s,{class:"ai-quiz-page"},{default:g(()=>[h(P,{title:"AI问答"}),h(s,{class:"page-content"},{default:g(()=>[h(s,{class:"progress-bar"},{default:g(()=>[h(s,{class:"progress-info"},{default:g(()=>[h(l,{class:"question-type ai-type"},{default:g(()=>{var e,a;return[C(I((a=null==(e=D.value)?void 0:e.type,{single:"单选题",multiple:"多选题",judge:"判断题"}[a||""]||"AI问答")),1)]}),_:1}),h(l,{class:"progress-text"},{default:g(()=>[C(I(Q.value+1)+"/"+I(F.value),1)]),_:1})]),_:1}),h(s,{class:"progress-line"},{default:g(()=>[h(s,{class:"progress-fill",style:x({width:G.value+"%"})},null,8,["style"])]),_:1})]),_:1}),D.value&&!o.value?(b(),_(s,{key:0,class:"question-card"},{default:g(()=>[h(l,{class:"question-text"},{default:g(()=>[C(I(D.value.question),1)]),_:1}),h(s,{class:"options-container"},{default:g(()=>[(b(!0),A(q,null,O(D.value.options,(e,a)=>(b(),_(t,{key:a,class:k(["option-btn",U(a)]),onClick:e=>(e=>{M.value||(E.value=L(e))})(a),disabled:M.value},{default:g(()=>[h(s,{class:k(["radio-icon",{selected:E.value===L(a)}])},{default:g(()=>[E.value===L(a)?(b(),_(s,{key:0,class:"radio-inner"})):w("",!0)]),_:2},1032,["class"]),h(s,{class:"option-content"},{default:g(()=>[h(l,{class:"option-prefix"},{default:g(()=>[C(I(R(a)),1)]),_:2},1024),h(l,{class:"option-text"},{default:g(()=>[C(I(e),1)]),_:2},1024)]),_:2},1024)]),_:2},1032,["class","onClick","disabled"]))),128))]),_:1}),J.value?(b(),_(t,{key:0,class:k(["submit-btn ai-analysis-btn",{analyzed:M.value}]),onClick:V,disabled:M.value},{default:g(()=>[h(l,{class:"submit-icon"},{default:g(()=>[C("🤖")]),_:1}),C(" "+I(M.value?"AI已解析":"AI解析"),1)]),_:1},8,["class","disabled"])):w("",!0)]),_:1})):w("",!0),o.value?(b(),_(s,{key:1,class:"loading-container"},{default:g(()=>[h(s,{class:"ai-thinking"},{default:g(()=>[h(s,{class:"ai-avatar"},{default:g(()=>[h(l,{class:"avatar-icon"},{default:g(()=>[C("🤖")]),_:1})]),_:1}),h(l,{class:"loading-text"},{default:g(()=>[C(I(N.value),1)]),_:1}),h(s,{class:"loading-dots"},{default:g(()=>[h(l,{class:"dot"}),h(l,{class:"dot"}),h(l,{class:"dot"})]),_:1})]),_:1})]),_:1})):w("",!0),M.value&&T.value?(b(),_(s,{key:2},{default:g(()=>[h(s,{class:"result-status-card"},{default:g(()=>[h(s,{class:"title-row"},{default:g(()=>[h(l,{class:"result-icon"},{default:g(()=>[C("🤖")]),_:1}),h(l,{class:"result-title"},{default:g(()=>[C("AI智能分析结果")]),_:1})]),_:1}),h(s,{class:"result-status"},{default:g(()=>[h(l,{class:k(["status-icon",{correct:T.value.isCorrect,wrong:!T.value.isCorrect}])},{default:g(()=>[C(I(T.value.isCorrect?"✓":"✗"),1)]),_:1},8,["class"]),h(l,{class:k(["status-text",{correct:T.value.isCorrect,wrong:!T.value.isCorrect}])},{default:g(()=>[C(I(T.value.successMessage||(T.value.isCorrect?"回答正确！AI分析准确":"很遗憾，答错了！")),1)]),_:1},8,["class"])]),_:1})]),_:1}),h(s,{class:"result-detail-card"},{default:g(()=>[h(s,{class:"correct-answer"},{default:g(()=>[h(l,{class:"answer-content"},{default:g(()=>[h(l,{class:"answer-label"},{default:g(()=>[C("正确答案：")]),_:1}),h(l,{class:"answer-text correct"},{default:g(()=>[C(I(Z()),1)]),_:1})]),_:1})]),_:1}),h(s,{class:"explanation"},{default:g(()=>[h(l,{class:"explanation-label"},{default:g(()=>[C("AI深度解析：")]),_:1}),h(l,{class:"explanation-text"},{default:g(()=>[C(I(T.value.explanation),1)]),_:1})]),_:1}),T.value.learningAdvice?(b(),_(s,{key:0,class:"ai-recommendations"},{default:g(()=>[h(s,{class:"rec-header"},{default:g(()=>[h(l,{class:"rec-icon"},{default:g(()=>[C("💡")]),_:1}),h(l,{class:"rec-label"},{default:g(()=>[C("AI学习建议：")]),_:1})]),_:1}),h(l,{class:"rec-content"},{default:g(()=>[C(I(T.value.learningAdvice),1)]),_:1})]),_:1})):w("",!0),h(t,{class:"next-btn",onClick:X},{default:g(()=>[C(I(H.value?"完成练习":"下一题"),1)]),_:1})]),_:1})]),_:1})):w("",!0)]),_:1})]),_:1})}}}),[["__scopeId","data-v-32d64b77"]]);export{$ as default};
