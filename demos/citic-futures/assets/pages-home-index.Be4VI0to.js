var t=(t,s,a)=>new Promise((e,n)=>{var l=t=>{try{c(a.next(t))}catch(s){n(s)}},i=t=>{try{c(a.throw(t))}catch(s){n(s)}},c=t=>t.done?e(t.value):Promise.resolve(t.value).then(l,i);c((a=a.apply(t,s)).next())});import{d as s,u as a,r as e,p as n,o as l,a as i,q as c,s as u,e as o,w as d,v as r,i as f,f as _,g,j as m,k as y,t as h,x as k,F as p,y as w,z as v,A as x,B as b}from"./index-BWcxsYn8.js";import{C}from"./CustomTabBar.CiXty17D.js";import{N as D}from"./NavigationBar.BembfXLU.js";import{_ as N}from"./_plugin-vue_export-helper.BCo6x5W8.js";const Q=N(s({__name:"index",setup(s,{expose:N}){const Q=a(),R=e({answeredQuestions:0,totalQuestions:0,trainingWinRate:0,continuousDays:0}),j=e([]),A=n({stats:!0,news:!0});l(()=>t(this,null,function*(){if(yield Q.init(),!Q.isLoggedIn)return console.log("用户未登录，跳转到登录页"),void i({url:"/pages/auth/login"});yield Promise.all([I(),L(),P()])}));const I=()=>t(this,null,function*(){try{A.stats=!0;const t=yield c.getRankInfo();if(0===t.code&&t.data){const s=t.data;let a=0,e=0,n=0,l=0;s.forEach(t=>{if(t.rankList&&t.rankList.length>0){const s=t.rankList[0];a+=s.correctTotal||0,e+=s.totalNumber||0,n+=s.accuracyRate||0,l++}}),R.value={answeredQuestions:a,totalQuestions:e,trainingWinRate:l>0?Math.round(n/l*100):0,continuousDays:R.value.continuousDays}}}catch(t){console.error("加载用户统计数据失败:",t),u({title:"加载统计数据失败",icon:"none"})}finally{A.stats=!1}}),P=()=>t(this,null,function*(){try{const t=yield c.getSignInSummary();0===t.code&&t.data&&(R.value.continuousDays=t.data.continuousDay||0)}catch(t){console.error("加载签到数据失败:",t)}}),L=()=>t(this,null,function*(){try{A.news=!0;const t=yield c.getNewsFlash(5);0===t.code&&t.data&&(j.value=t.data.map(t=>({id:t.kxId,title:t.title||t.kxContents||"无标题",content:t.kxContents,summary:t.kxContents,publishedAt:t.postTime,url:"#"})))}catch(t){console.error("加载资讯失败:",t),u({title:"加载资讯失败",icon:"none"})}finally{A.news=!1}}),q=()=>{b({url:"/pages/quiz/index"})},z=()=>{b({url:"/pages/training/index"})},B=()=>{x({url:"/pages/tasks/index"})},S=()=>{x({url:"/pages/ranking/index"})};return N({onPullDownRefresh:()=>t(this,null,function*(){try{yield Promise.all([I(),L(),P()]),u({title:"刷新成功",icon:"success"})}catch(t){u({title:"刷新失败",icon:"none"})}finally{r()}})}),(t,s)=>{const a=m,e=f;return _(),o(e,{class:"home-container"},{default:d(()=>[g(D,{title:"首页"}),g(e,{class:"page-content"},{default:d(()=>[A.stats?(_(),o(e,{key:1,class:"stats-card loading"},{default:d(()=>[g(e,{class:"grid-stats"},{default:d(()=>[(_(),k(p,null,w(3,t=>g(e,{class:"stat-item",key:t},{default:d(()=>[g(e,{class:"skeleton skeleton-value"}),g(a,{class:"stat-label"},{default:d(()=>[y("加载中...")]),_:1})]),_:2},1024)),64))]),_:1})]),_:1})):(_(),o(e,{key:0,class:"stats-card"},{default:d(()=>[g(e,{class:"grid-stats"},{default:d(()=>[g(e,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value blue"},{default:d(()=>[y(h(R.value.answeredQuestions)+"/"+h(R.value.totalQuestions),1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[y("已答题")]),_:1})]),_:1}),g(e,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value green"},{default:d(()=>[y(h(R.value.trainingWinRate)+"%",1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[y("训练胜率")]),_:1})]),_:1}),g(e,{class:"stat-item"},{default:d(()=>[g(a,{class:"stat-value orange"},{default:d(()=>[y(h(R.value.continuousDays),1)]),_:1}),g(a,{class:"stat-label"},{default:d(()=>[y("连续打卡")]),_:1})]),_:1})]),_:1})]),_:1})),g(e,{class:"function-grid"},{default:d(()=>[g(e,{class:"function-item blue-gradient",onClick:q},{default:d(()=>[g(e,{class:"function-header"},{default:d(()=>[g(e,{class:"function-icon fa-icon quiz-icon"}),g(a,{class:"function-title"},{default:d(()=>[y("知识问答")]),_:1})]),_:1}),g(a,{class:"function-desc"},{default:d(()=>[y("专业题库训练")]),_:1})]),_:1}),g(e,{class:"function-item green-gradient",onClick:z},{default:d(()=>[g(e,{class:"function-header"},{default:d(()=>[g(e,{class:"function-icon fa-icon training-icon"}),g(a,{class:"function-title"},{default:d(()=>[y("交易训练")]),_:1})]),_:1}),g(a,{class:"function-desc"},{default:d(()=>[y("模拟交易体验")]),_:1})]),_:1}),g(e,{class:"function-item purple-gradient",onClick:B},{default:d(()=>[g(e,{class:"function-header"},{default:d(()=>[g(e,{class:"function-icon fa-icon task-icon"}),g(a,{class:"function-title"},{default:d(()=>[y("每日任务")]),_:1})]),_:1}),g(a,{class:"function-desc"},{default:d(()=>[y("完成任务奖励")]),_:1})]),_:1}),g(e,{class:"function-item yellow-gradient",onClick:S},{default:d(()=>[g(e,{class:"function-header"},{default:d(()=>[g(e,{class:"function-icon fa-icon ranking-icon"}),g(a,{class:"function-title"},{default:d(()=>[y("排行榜")]),_:1})]),_:1}),g(a,{class:"function-desc"},{default:d(()=>[y("查看学习排名")]),_:1})]),_:1})]),_:1}),g(e,{class:"news-card"},{default:d(()=>[g(e,{class:"news-header"},{default:d(()=>[g(a,{class:"news-title"},{default:d(()=>[y("相关资讯")]),_:1})]),_:1}),!A.news&&j.value.length>0?(_(),o(e,{key:0,class:"news-list"},{default:d(()=>[(_(!0),k(p,null,w(j.value,t=>(_(),o(e,{class:"news-item",key:t.id,onClick:s=>(t=>{const s={id:t.id,title:t.title,content:t.content||t.summary||"",publishedAt:t.publishedAt||""};v("currentNews",JSON.stringify(s)),x({url:`/pages/training/news-detail?id=${t.id}`})})(t)},{default:d(()=>[g(e,{class:"news-content"},{default:d(()=>[g(a,{class:"news-item-title"},{default:d(()=>[y(h(t.title),1)]),_:2},1024),g(a,{class:"news-summary"},{default:d(()=>{return[y(h((s=t.summary,a=80,s?s.length<=a?s:s.substring(0,a)+"...":"")),1)];var s,a}),_:2},1024),g(a,{class:"news-time"},{default:d(()=>[y(h(t.publishedAt),1)]),_:2},1024)]),_:2},1024),g(a,{class:"news-arrow"},{default:d(()=>[y("›")]),_:1})]),_:2},1032,["onClick"]))),128))]),_:1})):A.news?(_(),o(e,{key:1,class:"news-list"},{default:d(()=>[(_(),k(p,null,w(2,t=>g(e,{class:"news-item",key:t},{default:d(()=>[g(e,{class:"skeleton skeleton-news"})]),_:2},1024)),64))]),_:1})):(_(),o(e,{key:2,class:"empty-state"},{default:d(()=>[g(a,{class:"empty-text"},{default:d(()=>[y("暂无资讯")]),_:1})]),_:1}))]),_:1}),g(C)]),_:1})]),_:1})}}}),[["__scopeId","data-v-c3751aee"]]);export{Q as default};
