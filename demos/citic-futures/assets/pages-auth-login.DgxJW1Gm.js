var e=(e,l,a)=>new Promise((s,t)=>{var n=e=>{try{c(a.next(e))}catch(l){t(l)}},u=e=>{try{c(a.throw(e))}catch(l){t(l)}},c=e=>e.done?s(e.value):Promise.resolve(e.value).then(n,u);c((a=a.apply(e,l)).next())});import{d as l,u as a,r as s,o as t,a as n,c as u,b as c,e as o,w as i,i as d,f as r,g as f,h as p,j as v,k as _,I as g,l as m,n as h,t as b,m as x}from"./index-BWcxsYn8.js";import{_ as y}from"./_plugin-vue_export-helper.BCo6x5W8.js";const I=y(l({__name:"login",setup(l){const y=a(),I=s(""),k=s(""),w=s(0);let V=null;t(()=>e(this,null,function*(){console.log("登录页面初始化，检查登录状态..."),yield y.init(),y.isLoggedIn&&(console.log("用户已登录，跳转到首页"),n({url:"/pages/home/index"}))}));const L=u(()=>/^1[3-9]\d{9}$/.test(I.value)&&0===w.value),j=u(()=>/^1[3-9]\d{9}$/.test(I.value)&&k.value.length>0&&!y.isLoading),C=e=>{const l=e.detail.value.replace(/\D/g,"");I.value=l.slice(0,11)},$=()=>e(this,null,function*(){if(L.value)try{yield y.sendVerificationCode(I.value),P()}catch(e){console.error("发送验证码失败:",e)}}),P=()=>{w.value=60,V=setInterval(()=>{w.value--,w.value<=0&&(clearInterval(V),V=null)},1e3)},U=()=>e(this,null,function*(){if(j.value)try{console.log("开始登录流程..."),yield y.login(I.value,k.value),console.log("登录成功，当前登录状态:",y.isLoggedIn),console.log("用户信息:",y.user),n({url:"/pages/home/index"})}catch(e){console.error("登录失败:",e),k.value=""}});return c(()=>{V&&clearInterval(V)}),(e,l)=>{const a=p,s=v,t=d,n=g,u=m;return r(),o(t,{class:"login-container"},{default:i(()=>[f(t,{class:"app-logo"},{default:i(()=>[f(a,{class:"logo-img",src:"https://source.unsplash.com/80x80/?finance,avatar",mode:"aspectFit"}),f(s,{class:"app-name"},{default:i(()=>[_("交易训练营")]),_:1}),f(s,{class:"app-desc"},{default:i(()=>[_("专业的期货交易学习平台")]),_:1})]),_:1}),f(t,{class:"login-form"},{default:i(()=>[f(t,{class:"form-item"},{default:i(()=>[f(t,{class:"input-wrapper"},{default:i(()=>[f(s,{class:"input-icon fas fa-phone"}),f(n,{id:"phone-input",modelValue:I.value,"onUpdate:modelValue":l[0]||(l[0]=e=>I.value=e),type:"number",placeholder:"请输入手机号",class:"input",maxlength:"11",onInput:C},null,8,["modelValue"])]),_:1})]),_:1}),f(t,{class:"form-item"},{default:i(()=>[f(t,{class:"code-input-container"},{default:i(()=>[f(t,{class:"input-wrapper code-input"},{default:i(()=>[f(s,{class:"input-icon fas fa-shield-alt"}),f(n,{id:"code-input",modelValue:k.value,"onUpdate:modelValue":l[1]||(l[1]=e=>k.value=e),type:"number",placeholder:"请输入验证码",class:"input",maxlength:"6"},null,8,["modelValue"])]),_:1}),f(u,{class:h(["code-btn",{disabled:!L.value||w.value>0}]),disabled:!L.value||w.value>0,onClick:$},{default:i(()=>[f(s,null,{default:i(()=>[_(b(w.value>0?`${w.value}s`:"获取验证码"),1)]),_:1})]),_:1},8,["class","disabled"])]),_:1})]),_:1})]),_:1}),f(u,{class:h(["login-btn",{disabled:!j.value}]),disabled:!j.value,onClick:U},{default:i(()=>[x(y).isLoading?(r(),o(s,{key:0},{default:i(()=>[_("登录中...")]),_:1})):(r(),o(s,{key:1},{default:i(()=>[_("登录/注册")]),_:1}))]),_:1},8,["class","disabled"]),f(t,{class:"tip-text"},{default:i(()=>[_("未注册手机号将自动创建新账号")]),_:1}),f(t,{class:"agreement-text"},{default:i(()=>[_(" 登录即表示同意 "),f(s,{class:"link"},{default:i(()=>[_("用户协议")]),_:1}),_(" 和 "),f(s,{class:"link"},{default:i(()=>[_("隐私政策")]),_:1})]),_:1}),f(t,{class:"divider"},{default:i(()=>[f(t,{class:"divider-line"}),f(s,{class:"divider-text"},{default:i(()=>[_("其他登录方式")]),_:1}),f(t,{class:"divider-line"})]),_:1}),f(t,{class:"social-login"},{default:i(()=>[f(u,{class:"social-btn wechat"},{default:i(()=>[f(s,{class:"social-icon fab fa-weixin"})]),_:1})]),_:1}),f(t,{class:"contact-service"},{default:i(()=>[f(u,{class:"service-btn"},{default:i(()=>[f(s,{class:"service-icon fas fa-headset"}),f(s,null,{default:i(()=>[_("遇到问题？联系客服")]),_:1})]),_:1})]),_:1})]),_:1})}}}),[["__scopeId","data-v-c56c02c3"]]);export{I as default};
