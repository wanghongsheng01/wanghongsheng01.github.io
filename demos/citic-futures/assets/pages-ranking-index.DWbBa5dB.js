var a=(a,t,e)=>new Promise((s,l)=>{var c=a=>{try{r(e.next(a))}catch(t){l(t)}},n=a=>{try{r(e.throw(a))}catch(t){l(t)}},r=a=>a.done?s(a.value):Promise.resolve(a.value).then(c,n);r((e=e.apply(a,t)).next())});import{d as t,r as e,o as s,e as l,w as c,s as n,i as r,f as u,g as i,J as o,j as d,k as f,x as _,F as k,y as m,n as g,t as p}from"./index-BWcxsYn8.js";import{m as v}from"./mockApi.Dwynr1J8.js";import{C as y}from"./CustomTabBar.CiXty17D.js";import{N as h}from"./NavigationBar.BembfXLU.js";import{_ as M}from"./_plugin-vue_export-helper.BCo6x5W8.js";const R=M(t({__name:"index",setup(t){const M=e([]),R=e([]),b=e(null),x=e(!0);e(!1);const w=a=>(a.details.correctRate||0)+.1*(a.details.totalCount||0)+2*(a.details.continuousDays||0),D=a=>(a.details.winRate||0)+.5*(a.details.totalCount||0)+0,z=()=>a(this,null,function*(){try{const a=yield v.getQuizRankings(1,20);200===a.code?M.value=(a.data||[]).map(a=>({id:a.userId,username:a.nickname,avatar:a.avatar,totalQuestions:a.details.totalCount||0,correctAnswers:Math.floor((a.details.totalCount||0)*(a.details.correctRate||0)/100),accuracy:(a.details.correctRate||0)/100,consecutiveDays:a.details.continuousDays||0,score:w(a),rank:a.rank})):generateMockData()}catch(a){generateMockData()}}),C=()=>a(this,null,function*(){try{const a=yield v.getTradingRankings(1,20);200===a.code?R.value=(a.data||[]).map(a=>({id:a.userId,username:a.nickname,avatar:a.avatar,totalTrades:a.details.totalCount||0,accuracy:(a.details.winRate||0)/100,score:D(a),rank:a.rank})):generateMockData()}catch(a){generateMockData()}}),j=()=>a(this,null,function*(){try{const a=yield v.getUserRanking();if(200===a.code&&a.data){const t=a.data;b.value={id:"current_user",username:"æˆ‘",avatar:"https://via.placeholder.com/48x48/e0e0e0/757575?text=U",quizRank:t.quizRank||0,tradingRank:t.tradingRank||0,quizGap:Math.floor(50*Math.random())+10,tradingGap:Math.floor(30*Math.random())+5}}}catch(a){console.error("åŠ è½½ç”¨æˆ·æ’åå¤±è´¥:",a),n({title:"åŠ è½½å¤±è´¥",icon:"none"})}});return s(()=>a(this,null,function*(){x.value=!0;try{yield Promise.all([z(),C(),j()])}catch(a){generateMockData()}finally{x.value=!1}})),(a,t)=>{const e=d,s=r;return u(),l(s,{class:"ranking-page"},{default:c(()=>[i(h,{title:"æ’è¡Œæ¦œ"}),i(s,{class:"page-content"},{default:c(()=>[i(s,{class:"ranking-section"},{default:c(()=>[i(s,{class:"section-header"},{default:c(()=>[i(e,{class:"section-icon"},{default:c(()=>[f("â“")]),_:1}),i(e,{class:"section-title"},{default:c(()=>[f("é—®ç­”æ’è¡Œæ¦œ")]),_:1})]),_:1}),i(s,{class:"ranking-list"},{default:c(()=>[(u(!0),_(k,null,m(M.value,(a,t)=>(u(),l(s,{key:a.id,class:g(["ranking-item",{"top-five":t<5,"top-three":t<3,"first-place":0===t}])},{default:c(()=>[i(s,{class:"rank-badge"},{default:c(()=>[0===t?(u(),l(e,{key:0,class:"crown-icon"},{default:c(()=>[f("ğŸ‘‘")]),_:1})):1===t?(u(),l(e,{key:1,class:"medal-icon"},{default:c(()=>[f("ğŸ¥ˆ")]),_:1})):2===t?(u(),l(e,{key:2,class:"medal-icon"},{default:c(()=>[f("ğŸ¥‰")]),_:1})):(u(),l(e,{key:3,class:"rank-number"},{default:c(()=>[f(p(t+1),1)]),_:2},1024))]),_:2},1024),i(s,{class:"user-info"},{default:c(()=>[i(e,{class:"user-name"},{default:c(()=>[f(p(a.username),1)]),_:2},1024),i(s,{class:"stats"},{default:c(()=>[i(e,{class:"stat-item"},{default:c(()=>[f("ç­”é¢˜"+p(a.totalQuestions)+"é¢˜",1)]),_:2},1024),i(e,{class:"stat-item"},{default:c(()=>[f("æ­£ç¡®ç‡"+p(Math.round(100*a.accuracy))+"%",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(s,{class:"score-section"},{default:c(()=>[i(e,{class:"final-score"},{default:c(()=>[f(p(Math.round(a.score)),1)]),_:2},1024),i(e,{class:"score-label"},{default:c(()=>[f("ç»¼åˆåˆ†")]),_:1})]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),i(s,{class:"ranking-section"},{default:c(()=>[i(s,{class:"section-header"},{default:c(()=>[i(e,{class:"section-icon"},{default:c(()=>[f("ğŸ“ˆ")]),_:1}),i(e,{class:"section-title"},{default:c(()=>[f("è®­ç»ƒæ’è¡Œæ¦œ")]),_:1})]),_:1}),i(s,{class:"ranking-list trading-list"},{default:c(()=>[(u(!0),_(k,null,m(R.value,(a,t)=>(u(),l(s,{key:a.id,class:g(["ranking-item",{"top-five":t<5,"top-three":t<3,"first-place":0===t}])},{default:c(()=>[i(s,{class:"rank-badge"},{default:c(()=>[0===t?(u(),l(e,{key:0,class:"crown-icon"},{default:c(()=>[f("ğŸ‘‘")]),_:1})):1===t?(u(),l(e,{key:1,class:"medal-icon"},{default:c(()=>[f("ğŸ¥ˆ")]),_:1})):2===t?(u(),l(e,{key:2,class:"medal-icon"},{default:c(()=>[f("ğŸ¥‰")]),_:1})):(u(),l(e,{key:3,class:"rank-number"},{default:c(()=>[f(p(t+1),1)]),_:2},1024))]),_:2},1024),i(s,{class:"user-info"},{default:c(()=>[i(e,{class:"user-name"},{default:c(()=>[f(p(a.username),1)]),_:2},1024),i(s,{class:"stats"},{default:c(()=>[i(e,{class:"stat-item"},{default:c(()=>[f("è®­ç»ƒ"+p(a.totalTrades)+"æ¬¡",1)]),_:2},1024),i(e,{class:"stat-item"},{default:c(()=>[f("é¢„æµ‹å‡†ç¡®ç‡"+p(Math.round(100*a.accuracy))+"%",1)]),_:2},1024)]),_:2},1024)]),_:2},1024),i(s,{class:"score-section"},{default:c(()=>[i(e,{class:"final-score"},{default:c(()=>[f(p(Math.round(a.score)),1)]),_:2},1024),i(e,{class:"score-label"},{default:c(()=>[f("ç»¼åˆåˆ†")]),_:1})]),_:2},1024)]),_:2},1032,["class"]))),128))]),_:1})]),_:1}),b.value?(u(),l(s,{key:0,class:"user-ranking-card"},{default:c(()=>[i(s,{class:"card-content"},{default:c(()=>[i(s,{class:"user-section"},{default:c(()=>[i(s,{class:"user-detail"},{default:c(()=>[i(e,{class:"card-title"},{default:c(()=>[f(p(b.value.username),1)]),_:1}),i(e,{class:"card-subtitle"},{default:c(()=>[f("æˆ‘çš„æ’åæƒ…å†µ")]),_:1})]),_:1})]),_:1}),i(s,{class:"ranking-stats"},{default:c(()=>[i(s,{class:"stat-item"},{default:c(()=>[i(e,{class:"stat-label"},{default:c(()=>[f("é—®ç­”æ’å")]),_:1}),i(e,{class:"stat-value"},{default:c(()=>[f("#"+p(b.value.quizRank),1)]),_:1}),b.value.quizGap>0?(u(),l(e,{key:0,class:"gap-info"},{default:c(()=>[f("è·å‰ä¸€åå·®"+p(Math.round(b.value.quizGap))+"åˆ†",1)]),_:1})):o("",!0)]),_:1}),i(s,{class:"stat-item"},{default:c(()=>[i(e,{class:"stat-label"},{default:c(()=>[f("è®­ç»ƒæ’å")]),_:1}),i(e,{class:"stat-value"},{default:c(()=>[f("#"+p(b.value.tradingRank),1)]),_:1}),b.value.tradingGap>0?(u(),l(e,{key:0,class:"gap-info"},{default:c(()=>[f("è·å‰ä¸€åå·®"+p(Math.round(b.value.tradingGap))+"åˆ†",1)]),_:1})):o("",!0)]),_:1})]),_:1})]),_:1})]),_:1})):o("",!0),i(y)]),_:1})]),_:1})}}}),[["__scopeId","data-v-6a8ee8be"]]);export{R as default};
